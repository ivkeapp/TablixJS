!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TablixJS={})}(this,function(t){"use strict";class e{constructor(t,e=[]){this.table=t,this.originalData=e,this.filteredData=[...e],this.currentFilters={},this.currentSorts=[],this.serverTotalRows=null}getData(){return this.filteredData}setData(t){this.originalData=t,this.filteredData=[...t],this.table.paginationManager&&this.table.paginationManager.updatePaginationInfo()}setServerData(t,e=null){this.originalData=t,this.filteredData=[...t],this.serverTotalRows=e,this.table.paginationManager&&this.table.paginationManager.updatePaginationInfo(e)}getTotalRows(){return null!==this.serverTotalRows?this.serverTotalRows:this.originalData.length}applyFilter(t){this.currentFilters=t,this.filteredData=0===Object.keys(t).length?[...this.originalData]:this.originalData.filter(e=>Object.entries(t).every(([t,a])=>(e[t]+"").toLowerCase().includes((a+"").toLowerCase()))),this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}setFilteredData(t){this.filteredData=t,this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}applySorting(t){this.currentSorts=t,t&&0!==t.length&&(this.table.sortingManager&&this.table.sortingManager.currentSorts.length>0?this.table.sortingManager._applySorting():this.filteredData.sort((e,a)=>{for(const i of t){const{column:t,direction:r}=i,s=e[t],n=a[t];let l=0;if(n>s?l=-1:s>n&&(l=1),0!==l)return"desc"===r?-l:l}return 0}),this.table.paginationManager&&this.table.paginationManager.resetToFirstPage())}clearFilters(){this.currentFilters={},this.filteredData=[...this.originalData],this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}clearSorting(){this.currentSorts=[],this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}getPageData(t=1){const e=this.table.paginationManager?this.table.paginationManager.pageSize:10,a=(t-1)*e;return this.filteredData.slice(a,a+e)}}class a{constructor(t){this.table=t}renderTable(t,e=!1){const a=this.table.columnManager?this.table.columnManager.getColumns():this.table.options.columns||[],i=this.table.options.controls,r=this.table.virtualScrollManager&&this.table.virtualScrollManager.isEnabled();let s="",n=!1,l=0;const o=this.table.container.querySelector(".tablix-search-input");o&&(s=o.value,n=document.activeElement===o,l=o.selectionStart||0);let c=`<div class="tablix-wrapper" ${this.table.selectionManager&&this.table.selectionManager.options.enabled?`data-selection-enabled data-selection-mode="${this.table.selectionManager.options.mode}"`:"data-selection-disabled"}>`;if(!i.enabled||"top"!==i.position&&"both"!==i.position||(c+=this.renderControls("top")),r){c+=`<div class="tablix-scroll-container" style="height: ${this.table.options.virtualScroll.containerHeight||400}px; overflow: auto; position: relative; border: 1px solid #ddd;">`}if(c+='<table class="tablix-table" style="width:100%; border-collapse:collapse;">',c+='<thead class="tablix-thead"><tr class="tablix-header-row">',a.forEach(t=>{const e=this._isColumnSortable(t),a=this._getSortDirection(t.name);c+=`<th class="tablix-th${e?" tablix-sortable":""}${a?" tablix-sorted tablix-sorted-"+a:""}" data-column="${t.name}">`,c+='<div class="tablix-th-content">',c+=`<span class="tablix-th-text">${t.title||t.name}</span>`,e&&(c+='<span class="tablix-sort-indicator">',c+="asc"===a?'<span class="tablix-sort-arrow tablix-sort-asc" aria-label="Sorted ascending">↑</span>':"desc"===a?'<span class="tablix-sort-arrow tablix-sort-desc" aria-label="Sorted descending">↓</span>':'<span class="tablix-sort-arrow tablix-sort-none" aria-label="Not sorted">↕</span>',c+="</span>"),c+="</div>",c+="</th>"}),c+="</tr></thead>",c+='<tbody class="tablix-tbody">',r&&e?c+=`<tr class="tablix-placeholder-row" style="display: none;"><td colspan="${a.length}"></td></tr>`:0===t.length?c+=`<tr class="tablix-empty-row"><td colspan="${a.length}" class="tablix-empty-cell">No data available</td></tr>`:t.forEach((t,e)=>{let i=e;if(this.table.paginationManager&&"client"===this.table.paginationManager.options.mode){i=(this.table.paginationManager.currentPage-1)*this.table.paginationManager.pageSize+e}c+=`<tr class="tablix-row" data-row-index="${i}">`,a.forEach(e=>{const a=t[e.name];let i;if(this.table.columnManager){const r=this.table.columnManager.formatCellValue(e.name,a,t);i=r.isHtml?r.value:this.escapeHtml(r.value)}else i=e.renderer?e.renderer(a,t):this.escapeHtml(a);c+=`<td class="tablix-td">${i}</td>`}),c+="</tr>"}),c+="</tbody>",c+="</table>",r&&(c+="</div>"),c+='<div class="tablix-pagination-container"></div>',!i.enabled||"bottom"!==i.position&&"both"!==i.position||(c+=this.renderControls("bottom")),c+="</div>",this.table.container.innerHTML=c,s){const t=this.table.container.querySelector(".tablix-search-input");t&&(t.value=s)}if(this.renderPagination(),i.enabled&&this.bindControlEvents(),this.table.searchManager&&this.table.searchManager.bindEvents(),this.table.sortingManager&&this.bindSortEvents(),this.table.selectionManager&&this.table.selectionManager.options.enabled&&this.bindRowClickEvents(),this.table.filterUI&&this.table.filterUI.renderFilterIcons(),n){const t=this.table.container.querySelector(".tablix-search-input");t&&requestAnimationFrame(()=>{t.focus(),l>0&&t.setSelectionRange(l,l)})}this.table.eventManager.trigger("afterRender")}renderPagination(){const t=this.table.container.querySelector(".tablix-pagination-container");if(!t||!this.table.paginationManager)return;const e=this.table.paginationManager,a=e.getInfo();if(!e.options.enabled&&void 0!==e.options.enabled)return void(t.innerHTML="");if(1>=a.totalPages&&!e.options.showPageSizes)return void(t.innerHTML="");let i='<div class="tablix-pagination">';if(i+='<div class="tablix-pagination-info">',i+=0===a.totalRows?"No records found":`Showing ${a.startRow}-${a.endRow} of ${a.totalRows} records`,i+="</div>",e.options.showPageSizes&&e.options.pageSizeOptions.length>1&&(i+='<div class="tablix-pagination-page-size">',i+="Show ",i+='<select class="tablix-page-size-select">',e.options.pageSizeOptions.forEach(t=>{i+=`<option value="${t}"${t===a.pageSize?" selected":""}>${t}</option>`}),i+="</select>",i+=" records per page",i+="</div>"),a.totalPages>1){if(i+='<div class="tablix-pagination-nav">',e.options.showFirstLast){i+=`<button class="tablix-pagination-btn tablix-pagination-first" data-page="1"${1===a.currentPage?" disabled":""}>First</button>`}if(e.options.showPrevNext){i+=`<button class="tablix-pagination-btn tablix-pagination-prev" data-page="${a.currentPage-1}"${a.hasPrevPage?"":" disabled"}>Previous</button>`}if(e.options.showPageNumbers){e.getPageNumbers().forEach(t=>{if("..."===t)i+='<span class="tablix-pagination-ellipsis">...</span>';else{i+=`<button class="tablix-pagination-btn tablix-pagination-page${t===a.currentPage?" active":""}" data-page="${t}">${t}</button>`}})}if(e.options.showPrevNext){i+=`<button class="tablix-pagination-btn tablix-pagination-next" data-page="${a.currentPage+1}"${a.hasNextPage?"":" disabled"}>Next</button>`}if(e.options.showFirstLast){i+=`<button class="tablix-pagination-btn tablix-pagination-last" data-page="${a.totalPages}"${a.currentPage===a.totalPages?" disabled":""}>Last</button>`}i+="</div>"}a.isLoading&&(i+='<div class="tablix-pagination-loading">Loading...</div>'),i+="</div>",t.innerHTML=i,this.bindPaginationEvents()}bindPaginationEvents(){const t=this.table.container.querySelector(".tablix-pagination");if(!t)return;t.addEventListener("click",async t=>{if(t.target.classList.contains("tablix-pagination-btn")&&!t.target.disabled){t.preventDefault();const e=parseInt(t.target.dataset.page);if(!isNaN(e))try{await this.table.paginationManager.goToPage(e)}catch(t){console.error("Failed to navigate to page:",t)}}});const e=t.querySelector(".tablix-page-size-select");e&&e.addEventListener("change",async t=>{try{const e=parseInt(t.target.value);await this.table.paginationManager.changePageSize(e)}catch(t){console.error("Failed to change page size:",t)}})}escapeHtml(t){if(null==t)return"";const e=document.createElement("div");return e.textContent=""+t,e.innerHTML}renderLoading(){this.table.container.innerHTML='<div class="tablix-loading">Loading...</div>'}renderError(t){this.table.container.innerHTML=`<div class="tablix-error">Error: ${this.escapeHtml(t.message||t)}</div>`}renderControls(t){const e=this.table.options.controls,a=this.table.options.search||{enabled:!1,placeholder:"Search..."};let i=`<div class="tablix-controls tablix-controls-${t}">`;if(i+='<div class="tablix-controls-left">',e.pagination&&this.table.paginationManager&&(i+='<div class="tablix-control-group tablix-pagination-controls">',i+='<button type="button" class="tablix-btn tablix-control-btn" data-action="firstPage">First</button>',i+='<button type="button" class="tablix-btn tablix-control-btn" data-action="prevPage">Previous</button>',i+='<button type="button" class="tablix-btn tablix-control-btn" data-action="nextPage">Next</button>',i+='<button type="button" class="tablix-btn tablix-control-btn" data-action="lastPage">Last</button>',i+="</div>"),e.pageSize&&this.table.paginationManager){const t=this.table.paginationManager.pageSize;i+='<div class="tablix-control-group tablix-page-size-group">',i+='<label for="tablix-page-size-select">Show:</label>',i+='<select class="tablix-page-size-select" id="tablix-page-size-select">',this.table.paginationManager.options.pageSizeOptions.forEach(e=>{i+=`<option value="${e}"${e===t?" selected":""}>${e}</option>`}),i+="</select>",i+="<span>entries</span>",i+="</div>"}if(e.refresh&&(i+='<div class="tablix-control-group tablix-refresh-group">',i+='<button type="button" class="tablix-btn tablix-control-btn" data-action="refresh" title="Refresh data">⟳</button>',i+="</div>"),i+="</div>",i+='<div class="tablix-controls-right">',e.search&&a.enabled){i+='<div class="tablix-control-group tablix-search-group">',i+=`<input type="text" \n                      class="tablix-search-input" \n                      id="tablix-search-input" \n                      name="table-search"\n                      placeholder="${a.placeholder||"Search..."}" />`,i+='<button type="button" class="tablix-btn tablix-search-clear" title="Clear search" style="display: none;">✕</button>',i+="</div>"}return i+="</div>",i+="</div>",i}bindControlEvents(){const t=this.table.container.querySelector(".tablix-wrapper");if(!t)return;const e=t.querySelector(".tablix-page-size-select");e&&e.addEventListener("change",async t=>{try{const e=parseInt(t.target.value);await this.table.changePageSize(e)}catch(t){console.error("Failed to change page size:",t)}}),t.addEventListener("click",async t=>{if(t.target.classList.contains("tablix-control-btn")){t.preventDefault();const e=t.target.dataset.action;try{switch(e){case"firstPage":await this.table.firstPage();break;case"prevPage":await this.table.prevPage();break;case"nextPage":await this.table.nextPage();break;case"lastPage":await this.table.lastPage();break;case"refresh":await this.handleRefresh();break;case"export":this.handleExport()}}catch(t){console.error(`Failed to execute action ${e}:`,t)}}})}async handleRefresh(){if(this.table.eventManager.trigger("beforeRefresh"),this.table.options.onRefresh&&"function"==typeof this.table.options.onRefresh)try{const t=await this.table.options.onRefresh();t&&await this.table.loadData(t)}catch(t){console.error("Custom refresh failed:",t)}else this.table.paginationManager&&"server"===this.table.paginationManager.options.mode?await this.table.paginationManager.refreshTable():await this.table.refreshTable();this.table.eventManager.trigger("afterRefresh")}handleExport(){const t=this.table.getData(),e=this.table.options.columns||[];let a=e.map(t=>t.title||t.name).join(",")+"\n";t.forEach(t=>{const i=e.map(e=>{const a=t[e.name];return"string"==typeof a&&a.includes(",")?`"${a.replace(/"/g,'""')}"`:a});a+=i.join(",")+"\n"});const i=new Blob([a],{type:"text/csv"}),r=URL.createObjectURL(i),s=document.createElement("a");s.href=r,s.download="table-data.csv",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(r),this.table.eventManager.trigger("afterExport",{data:t,format:"csv"})}bindSortEvents(){const t=this.table.container.querySelector(".tablix-header-row");t&&(t.addEventListener("click",async t=>{const e=t.target.closest(".tablix-sortable");if(!e)return;t.preventDefault();const a=e.dataset.column;try{await this.table.toggleSort(a)}catch(t){console.error("Failed to sort column:",t)}}),t.addEventListener("keydown",async t=>{const e=t.target.closest(".tablix-sortable");if(!e||"Enter"!==t.key&&" "!==t.key)return;t.preventDefault();const a=e.dataset.column;try{await this.table.toggleSort(a)}catch(t){console.error("Failed to sort column:",t)}}))}bindRowClickEvents(){const t=this.table.container.querySelector(".tablix-tbody");t&&t.addEventListener("click",t=>{const e=t.target.closest(".tablix-row");if(!e||e.classList.contains("tablix-empty-row"))return;const a=parseInt(e.dataset.rowIndex,10);if(isNaN(a))return;let i=a;if(this.table.paginationManager&&"client"===this.table.paginationManager.options.mode){i=a-(this.table.paginationManager.currentPage-1)*this.table.paginationManager.pageSize}const r=this.getCurrentPageData();if(i>=0&&r.length>i){this.table.eventManager.trigger("rowClick",{rowData:r[i],rowIndex:a,localRowIndex:i,originalEvent:t})}})}getCurrentPageData(){return this.table.paginationManager?this.table.paginationManager.getCurrentPageData()||[]:this.table.dataManager.getData()}updateSortIndicators(t){this.table.container.querySelectorAll(".tablix-th[data-column]").forEach(e=>{const a=t&&t.column===e.dataset.column;e.classList.remove("tablix-sorted","tablix-sorted-asc","tablix-sorted-desc");const i=e.querySelector(".tablix-sort-indicator");if(!i)return;const r=i.querySelector(".tablix-sort-arrow");r&&(a?(e.classList.add("tablix-sorted","tablix-sorted-"+t.direction),r.classList.remove("tablix-sort-none","tablix-sort-asc","tablix-sort-desc"),r.classList.add("tablix-sort-"+t.direction),r.textContent="asc"===t.direction?"↑":"↓",r.setAttribute("aria-label","Sorted "+("asc"===t.direction?"ascending":"descending")),r.removeAttribute("data-sort-order")):(r.classList.remove("tablix-sort-asc","tablix-sort-desc"),r.classList.add("tablix-sort-none"),r.textContent="↕",r.setAttribute("aria-label","Not sorted"),r.removeAttribute("data-sort-order")))})}_isColumnSortable(t){return!!this.table.sortingManager&&this.table.sortingManager.isColumnSortable(t.name)}_getSortDirection(t){return this.table.sortingManager?this.table.sortingManager.getSortDirection(t):null}}class i{constructor(){this.events={}}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}off(t,e){if(this.events[t]){const a=this.events[t].indexOf(e);a>-1&&this.events[t].splice(a,1)}}clear(t){t?this.events[t]=[]:this.events={}}trigger(t,e){(this.events[t]||[]).forEach(t=>t(e))}}class r{constructor(t,e={}){this.table=t,this.options={pageSize:10,mode:"client",showPageNumbers:!0,maxPageNumbers:5,showFirstLast:!0,showPrevNext:!0,showPageSizes:!1,pageSizeOptions:[10,25,50,100],serverDataLoader:null,...e},this.currentPage=1,this.totalPages=1,this.totalRows=0,this.pageSize=this.options.pageSize,this.isLoading=!1,this.init()}init(){this.updatePaginationInfo()}updatePaginationInfo(t=null){this.totalRows="client"===this.options.mode?this.table.dataManager.filteredData.length:t||this.totalRows,this.totalPages=Math.ceil(this.totalRows/this.pageSize)||1,this.currentPage>this.totalPages&&(this.currentPage=this.totalPages),1>this.currentPage&&(this.currentPage=1)}async getPageData(){return"client"===this.options.mode?this.getClientPageData():await this.getServerPageData()}getClientPageData(){const t=(this.currentPage-1)*this.pageSize;return this.table.dataManager.filteredData.slice(t,t+this.pageSize)}getCurrentPageData(){return"client"===this.options.mode?this.getClientPageData():this.table.dataManager.getData()}async getServerPageData(){if(!this.options.serverDataLoader)throw Error("Server data loader not configured for server-side pagination");this.isLoading=!0,this.table.eventManager.trigger("beforePageLoad",{page:this.currentPage,pageSize:this.pageSize});try{const t=await this.options.serverDataLoader({page:this.currentPage,pageSize:this.pageSize,filters:this.table.dataManager.currentFilters||{},sorts:this.table.dataManager.currentSorts||[]});return void 0!==t.totalRows&&this.updatePaginationInfo(t.totalRows),this.isLoading=!1,this.table.eventManager.trigger("afterPageLoad",{page:this.currentPage,pageSize:this.pageSize,data:t.data,totalRows:t.totalRows}),t.data}catch(t){throw this.isLoading=!1,this.table.eventManager.trigger("pageLoadError",t),t}}async goToPage(t){const e=Math.max(1,Math.min(t,this.totalPages));if(e===this.currentPage)return;const a=this.currentPage;this.currentPage=e,this.table.eventManager.trigger("beforePageChange",{oldPage:a,newPage:this.currentPage,pageSize:this.pageSize});try{await this.refreshTable(),this.table.eventManager.trigger("afterPageChange",{oldPage:a,newPage:this.currentPage,pageSize:this.pageSize})}catch(t){throw this.currentPage=a,t}}async nextPage(){this.totalPages>this.currentPage&&await this.goToPage(this.currentPage+1)}async prevPage(){this.currentPage>1&&await this.goToPage(this.currentPage-1)}async firstPage(){await this.goToPage(1)}async lastPage(){await this.goToPage(this.totalPages)}async changePageSize(t){if(t===this.pageSize)return;const e=this.pageSize;this.pageSize=t;const a=Math.floor((this.currentPage-1)*e/t)+1;this.updatePaginationInfo(),this.table.eventManager.trigger("beforePageSizeChange",{oldPageSize:e,newPageSize:this.pageSize,oldPage:this.currentPage,newPage:a}),this.currentPage=a,await this.refreshTable(),this.table.eventManager.trigger("afterPageSizeChange",{oldPageSize:e,newPageSize:this.pageSize,page:this.currentPage})}async refreshTable(){const t=await this.getPageData();this.table.renderer.renderTable(t),this.table.renderer.renderPagination()}async resetToFirstPage(){this.currentPage=1,this.updatePaginationInfo(),await this.refreshTable()}getInfo(){return{currentPage:this.currentPage,totalPages:this.totalPages,pageSize:this.pageSize,totalRows:this.totalRows,startRow:0===this.totalRows?0:(this.currentPage-1)*this.pageSize+1,endRow:Math.min(this.currentPage*this.pageSize,this.totalRows),hasNextPage:this.totalPages>this.currentPage,hasPrevPage:this.currentPage>1,isLoading:this.isLoading}}getPageNumbers(){const t=this.options.maxPageNumbers,e=[];if(t<this.totalPages){let a=Math.max(1,this.currentPage-Math.floor(t/2)),i=Math.min(this.totalPages,a+t-1);t>i-a+1&&(a=Math.max(1,i-t+1));for(let t=a;i>=t;t++)e.push(t);a>1&&(a>2&&e.unshift("..."),e.unshift(1)),this.totalPages>i&&(this.totalPages-1>i&&e.push("..."),e.push(this.totalPages))}else for(let t=1;this.totalPages>=t;t++)e.push(t);return e}setEnabled(t){this.options.enabled=t,this.table.renderer.renderPagination()}async setMode(t,e=null){t!==this.options.mode&&(this.options.mode=t,"server"===t&&e&&(this.options.serverDataLoader=e),this.currentPage=1,this.updatePaginationInfo(),await this.refreshTable())}}class s{constructor(t,e={}){this.table=t,this.options={enabled:!0,mode:"client",serverSortLoader:null,defaultSortType:"auto",caseSensitive:!1,nullsFirst:!1,...e},this.currentSort=null,this.sortOrder=["asc","desc",null],this.sortTypes={auto:this._autoSort.bind(this),string:this._stringSort.bind(this),number:this._numberSort.bind(this),date:this._dateSort.bind(this),boolean:this._booleanSort.bind(this)}}async sort(t,e="asc"){this.table.eventManager.trigger("beforeSort",{columnName:t,direction:e,currentSort:this.currentSort}),"server"===this.options.mode?await this._sortServer(t,e):this._sortClient(t,e),this.table.renderer.updateSortIndicators(this.currentSort),await this.table.refreshTable(),this.table.eventManager.trigger("afterSort",{columnName:t,direction:e,currentSort:this.currentSort})}async toggleSort(t){const e=this.sortOrder.indexOf(this.currentSort&&this.currentSort.column===t?this.currentSort.direction:null),a=this.sortOrder[(e+1)%this.sortOrder.length];await this.sort(t,a)}_sortClient(t,e){this.currentSort=null!==e?{column:t,direction:e}:null,this._applySorting()}async _sortServer(t,e){if(this.options.serverSortLoader){this.currentSort=null!==e?{column:t,direction:e}:null;try{const t=await this.options.serverSortLoader({sort:this.currentSort,filters:this.table.dataManager.currentFilters,page:this.table.paginationManager?this.table.paginationManager.currentPage:1,pageSize:this.table.paginationManager?this.table.paginationManager.pageSize:10});this.table.dataManager.setServerData(t.data,t.totalRows)}catch(t){throw console.error("Failed to load sorted data from server:",t),t}}else console.warn("Server-side sorting enabled but no serverSortLoader provided")}_applySorting(){if(!this.currentSort)return;const t=this.table.options.columns||[];this.table.dataManager.filteredData.sort((e,a)=>{const i=t.find(t=>t.name===this.currentSort.column||t.key===this.currentSort.column),r=this._compareValues(e[this.currentSort.column],a[this.currentSort.column],i);return"desc"===this.currentSort.direction?-r:r}),this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}_compareValues(t,e,a){if(null==t&&null==e)return 0;if(null==t)return this.options.nullsFirst?-1:1;if(null==e)return this.options.nullsFirst?1:-1;if(a&&a.sortFunction)return a.sortFunction(t,e);const i=a&&a.sortType||this.options.defaultSortType;return this.sortTypes[i]?this.sortTypes[i](t,e):this._autoSort(t,e)}_autoSort(t,e){const a=parseFloat(t),i=parseFloat(e);if(!isNaN(a)&&!isNaN(i))return a-i;const r=new Date(t),s=new Date(e),n=t=>/^\d{4}-\d{2}-\d{2}/.test(t)||/^\d{1,2}\/\d{1,2}\/\d{4}/.test(t)||/^\d{1,2}-\d{1,2}-\d{4}/.test(t);return""+r!="Invalid Date"&&""+s!="Invalid Date"&&n(t+"")&&n(e+"")?r-s:this._stringSort(t,e)}_stringSort(t,e){const a=(t+"").trim(),i=(e+"").trim();return this.options.caseSensitive?a.localeCompare(i):a.localeCompare(i,void 0,{sensitivity:"base"})}_numberSort(t,e){const a=parseFloat(t),i=parseFloat(e);return isNaN(a)&&isNaN(i)?0:isNaN(a)?1:isNaN(i)?-1:a-i}_dateSort(t,e){const a=new Date(t),i=new Date(e);return""+a=="Invalid Date"&&""+i=="Invalid Date"?0:""+a=="Invalid Date"?1:""+i=="Invalid Date"?-1:a-i}_booleanSort(t,e){const a=!!t;return a===!!e?0:a?1:-1}async clearSorting(){if(this.currentSort=null,"server"===this.options.mode&&this.options.serverSortLoader)try{const t=await this.options.serverSortLoader({sort:null,filters:this.table.dataManager.currentFilters,page:this.table.paginationManager?this.table.paginationManager.currentPage:1,pageSize:this.table.paginationManager?this.table.paginationManager.pageSize:10});this.table.dataManager.setServerData(t.data,t.totalRows)}catch(t){console.error("Failed to clear server sorting:",t)}this.table.renderer.updateSortIndicators(null),await this.table.refreshTable(),this.table.eventManager.trigger("afterSort",{currentSort:null})}getSortState(){return{sort:this.currentSort,mode:this.options.mode}}setOptions(t){this.options={...this.options,...t}}isColumnSortable(t){if(!this.options.enabled)return!1;const e=(this.table.options.columns||[]).find(e=>e.name===t);return e&&!1!==e.sortable}getSortDirection(t){return this.currentSort&&this.currentSort.column===t?this.currentSort.direction:null}}class n{constructor(t){this.table=t,this.columns=[],this.formatters=new Map,this.supportedFormats=["text","date","currency","number","percent"]}initializeColumns(t=[]){return this.columns=t.map(t=>this.prepareColumn(t)),this.compileFormatters(),this.columns}prepareColumn(t){const e={...t};if(e.format&&!this.supportedFormats.includes(e.format)&&(console.warn(`TablixJS: Unsupported format type '${e.format}' for column '${e.name}'. Falling back to no formatting.`),delete e.format),!e.name)throw Error('TablixJS: Column must have a "name" property');return e.title||(e.title=e.name),e}compileFormatters(){this.formatters.clear(),this.columns.forEach(t=>{if(t.format){const e=this.createFormatter(t);e&&this.formatters.set(t.name,e)}})}createFormatter(t){const{format:e,locale:a,formatOptions:i={}}=t;switch(e){case"text":return t=>this.formatText(t);case"date":return t=>this.formatDate(t,a,i);case"currency":return e=>this.formatCurrency(e,a,i,t.currency);case"number":return t=>this.formatNumber(t,a,i);case"percent":return t=>this.formatPercent(t,a,i);default:return null}}formatCellValue(t,e,a){const i=this.getColumn(t);if(i&&i.renderer){const r=this.formatters.get(t),s=r?r(e):e;return{value:i.renderer(e,a,s),isHtml:!0}}const r=this.formatters.get(t);return r?{value:r(e),isHtml:!1}:{value:e,isHtml:!1}}getColumn(t){return this.columns.find(e=>e.name===t)||null}getColumns(){return this.columns}formatText(t){return null==t?"":t+""}formatDate(t,e,a={}){if(null==t)return"";try{const i=t instanceof Date?t:new Date(t);if(isNaN(i.getTime()))return t+"";return new Intl.DateTimeFormat(e,a).format(i)}catch(e){return console.warn("TablixJS: Date formatting error:",e),t+""}}formatCurrency(t,e,a={},i="USD"){if(null==t)return"";const r=Number(t);if(isNaN(r))return t+"";try{const t={style:"currency",currency:i,...a};return new Intl.NumberFormat(e,t).format(r)}catch(e){return console.warn("TablixJS: Currency formatting error:",e),t+""}}formatNumber(t,e,a={}){if(null==t)return"";const i=Number(t);if(isNaN(i))return t+"";try{return new Intl.NumberFormat(e,a).format(i)}catch(e){return console.warn("TablixJS: Number formatting error:",e),t+""}}formatPercent(t,e,a={}){if(null==t)return"";const i=Number(t);if(isNaN(i))return t+"";try{const t={style:"percent",...a};return new Intl.NumberFormat(e,t).format(i)}catch(e){return console.warn("TablixJS: Percent formatting error:",e),t+""}}registerFormat(t,e){this.supportedFormats.includes(t)&&console.warn(`TablixJS: Format type '${t}' already exists and will be overridden.`),this.supportedFormats.push(t),console.log(`TablixJS: Custom format '${t}' registered.`)}getSupportedFormats(){return[...this.supportedFormats]}}class l{constructor(t,e={}){this.table=t,this.options={enabled:!0,mode:"client",serverFilterLoader:null,debounceDelay:300,showBadges:!0,showTooltips:!0,...e},this.columnFilters=new Map,this.operators={none:{label:"None",apply:()=>!0},isEmpty:{label:"Is empty",apply:t=>null==t||""===t},isNotEmpty:{label:"Is not empty",apply:t=>null!=t&&""!==t},equals:{label:"Is equal to",apply:(t,e)=>(t+"").toLowerCase()===(e+"").toLowerCase()},notEquals:{label:"Is not equal to",apply:(t,e)=>(t+"").toLowerCase()!==(e+"").toLowerCase()},beginsWith:{label:"Begins with",apply:(t,e)=>(t+"").toLowerCase().startsWith((e+"").toLowerCase())},endsWith:{label:"Ends with",apply:(t,e)=>(t+"").toLowerCase().endsWith((e+"").toLowerCase())},contains:{label:"Contains",apply:(t,e)=>(t+"").toLowerCase().includes((e+"").toLowerCase())},notContains:{label:"Does not contain",apply:(t,e)=>!(t+"").toLowerCase().includes((e+"").toLowerCase())}},this.debounceTimer=null,this.openDropdowns=new Set}async applyFilter(t,e){if(!this.validateFilterConfig(e))return void console.warn(`TablixJS: Invalid filter config for column '${t}'`);const a={columnName:t,filterConfig:e,currentFilters:this.getActiveFilters()};this.table.eventManager.trigger("beforeFilter",a),this.columnFilters.set(t,{type:e.type,config:e,isActive:this.isFilterActive(e)}),"server"===this.options.mode?await this._filterServer():this._filterClient(),this.updateFilterIndicators(),await this.table.refreshTable(),this.table.eventManager.trigger("afterFilter",{columnName:t,filterConfig:e,filteredData:this.table.dataManager.getData(),activeFilters:this.getActiveFilters()})}async clearFilter(t){if(!this.columnFilters.has(t))return;const e={columnName:t,filterConfig:null,currentFilters:this.getActiveFilters()};this.table.eventManager.trigger("beforeFilter",e),this.columnFilters.delete(t),"server"===this.options.mode?await this._filterServer():this._filterClient(),this.updateFilterIndicators(),await this.table.refreshTable(),this.table.eventManager.trigger("afterFilter",{columnName:t,filterConfig:null,filteredData:this.table.dataManager.getData(),activeFilters:this.getActiveFilters()})}async clearAllFilters(){if(0===this.columnFilters.size)return;const t={columnName:null,filterConfig:null,currentFilters:this.getActiveFilters()};this.table.eventManager.trigger("beforeFilter",t),this.columnFilters.clear(),"server"===this.options.mode?await this._filterServer():this._filterClient(),this.updateFilterIndicators(),await this.table.refreshTable(),this.table.eventManager.trigger("afterFilter",{columnName:null,filterConfig:null,filteredData:this.table.dataManager.getData(),activeFilters:this.getActiveFilters()})}getActiveFilters(){const t={};for(const[e,a]of this.columnFilters)a.isActive&&(t[e]=a.config);return t}getColumnUniqueValues(t){const e=this.table.dataManager.originalData,a=new Set;return e.forEach(e=>{const i=e[t];null!=i&&a.add(i+"")}),Array.from(a).sort()}getColumnFilter(t){return this.columnFilters.get(t)||null}hasColumnFilter(t){const e=this.columnFilters.get(t);return e&&e.isActive}validateFilterConfig(t){return!(!t||!t.type)&&("value"===t.type?Array.isArray(t.values):"condition"===t.type&&(Array.isArray(t.conditions)&&t.conditions.every(t=>t.operator&&this.operators[t.operator])))}isFilterActive(t){return!!t&&("value"===t.type?t.values&&t.values.length>0:"condition"===t.type&&(t.conditions&&t.conditions.some(t=>t.operator&&"none"!==t.operator&&("isEmpty"===t.operator||"isNotEmpty"===t.operator||void 0!==t.value))))}_filterClient(){const t=this.table.dataManager.originalData,e=this.getActiveFilters();let a;a=0===Object.keys(e).length?[...t]:t.filter(t=>Object.entries(e).every(([e,a])=>this._testRowAgainstFilter(t,e,a))),this.table.dataManager.setFilteredData(a)}async _filterServer(){if(this.options.serverFilterLoader)try{const t=await this.options.serverFilterLoader({filters:this.getActiveFilters(),sort:this.table.sortingManager?this.table.sortingManager.currentSort:null,page:this.table.paginationManager?this.table.paginationManager.currentPage:1,pageSize:this.table.paginationManager?this.table.paginationManager.pageSize:10});this.table.dataManager.setServerData(t.data,t.totalRows)}catch(t){throw console.error("Failed to load filtered data from server:",t),t}else console.warn("TablixJS: Server-side filtering enabled but no serverFilterLoader provided")}_testRowAgainstFilter(t,e,a){const i=t[e];return"value"===a.type?a.values.includes(i+""):"condition"!==a.type||a.conditions.every(t=>{const e=this.operators[t.operator];return!e||e.apply(i,t.value)})}updateFilterIndicators(){this.table.container.querySelectorAll(".tablix-th").forEach(t=>{const e=t.dataset.column,a=this.hasColumnFilter(e),i=t.querySelector(".tablix-filter-indicator");if(a)t.classList.add("tablix-filtered"),i&&(i.classList.add("tablix-filter-active"),this.options.showBadges&&this._updateFilterBadge(t,e));else if(t.classList.remove("tablix-filtered"),i){i.classList.remove("tablix-filter-active");const t=i.querySelector(".tablix-filter-badge");t&&t.remove()}})}_updateFilterBadge(t,e){const a=t.querySelector(".tablix-filter-indicator");if(!a)return;const i=this.getColumnFilter(e);if(!i||!i.isActive)return;let r="";if("value"===i.type)r=""+i.config.values.length;else if("condition"===i.type){r=""+i.config.conditions.filter(t=>t.operator&&"none"!==t.operator).length}let s=a.querySelector(".tablix-filter-badge");!s&&r&&(s=document.createElement("span"),s.className="tablix-filter-badge",a.appendChild(s)),s&&(s.textContent=r)}registerOperator(t,e){if(!e.label||"function"!=typeof e.apply)throw Error("TablixJS: Custom operator must have label and apply function");this.operators[t]=e}getOperators(){return{...this.operators}}}class o{constructor(t){this.filterManager=t,this.table=t.table,this.activeDropdown=null,this.handleDocumentClick=this.handleDocumentClick.bind(this),this.handleFilterIconClick=this.handleFilterIconClick.bind(this),this.init()}init(){document.addEventListener("click",this.handleDocumentClick)}destroy(){document.removeEventListener("click",this.handleDocumentClick),this.closeAllDropdowns()}renderFilterIcons(){this.table.container.querySelectorAll(".tablix-th").forEach(t=>{const e=t.dataset.column;if(!e)return;if(t.querySelector(".tablix-filter-indicator"))return;const a=t.querySelector(".tablix-th-content");if(!a)return;const i=document.createElement("span");i.className="tablix-filter-indicator",i.innerHTML='\n        <span class="tablix-filter-icon" title="Filter column">⚪</span>\n      ',i.addEventListener("click",t=>{t.stopPropagation(),this.handleFilterIconClick(e,i)});const r=a.querySelector(".tablix-sort-indicator");r?a.insertBefore(i,r.nextSibling):a.appendChild(i)})}handleFilterIconClick(t,e){this.closeAllDropdowns();const a=this.createFilterDropdown(t);this.showDropdown(a,e),this.activeDropdown={dropdown:a,columnName:t}}handleDocumentClick(t){if(this.activeDropdown){this.activeDropdown.dropdown.contains(t.target)||this.closeAllDropdowns()}}createFilterDropdown(t){const e=document.createElement("div");return e.className="tablix-filter-dropdown",e.innerHTML=this.renderDropdownContent(t),this.bindDropdownEvents(e,t),e}renderDropdownContent(t){const e=this.filterManager.getColumnFilter(t);return`\n      <div class="tablix-filter-dropdown-header">\n        <h4>Filter: ${t}</h4>\n        <button class="tablix-filter-close" type="button">×</button>\n      </div>\n      \n      <div class="tablix-filter-tabs">\n        <button class="tablix-filter-tab ${e&&"value"!==e.type?"":"active"}" \n                data-tab="value">Filter by Value</button>\n        <button class="tablix-filter-tab ${e&&"condition"===e.type?"active":""}" \n                data-tab="condition">Filter by Condition</button>\n      </div>\n      \n      <div class="tablix-filter-content">\n        <div class="tablix-filter-panel tablix-filter-value-panel ${e&&"value"!==e.type?"":"active"}">\n          ${this.renderValueFilterPanel(t,e)}\n        </div>\n        \n        <div class="tablix-filter-panel tablix-filter-condition-panel ${e&&"condition"===e.type?"active":""}">\n          ${this.renderConditionFilterPanel(t,e)}\n        </div>\n      </div>\n      \n      <div class="tablix-filter-actions">\n        <button class="tablix-filter-apply" type="button">Apply</button>\n        <button class="tablix-filter-clear" type="button">Clear</button>\n        <button class="tablix-filter-cancel" type="button">Cancel</button>\n      </div>\n    `}renderValueFilterPanel(t,e){const a=this.filterManager.getColumnUniqueValues(t),i=e&&"value"===e.type?e.config.values:[];if(0===a.length)return'<p class="tablix-filter-empty">No values available</p>';let r=`\n      <div class="tablix-filter-search">\n        <input type="text" \n               id="tablix-filter-search-${t}" \n               name="filter-search-${t}"\n               placeholder="Search values..." \n               class="tablix-filter-search-input">\n      </div>\n      <div class="tablix-filter-select-all">\n        <label>\n          <input type="checkbox" \n                 id="tablix-filter-select-all-${t}" \n                 name="filter-select-all-${t}"\n                 class="tablix-filter-select-all-checkbox"> Select All\n        </label>\n      </div>\n      <div class="tablix-filter-values">\n    `;return a.forEach((e,a)=>{const s=i.includes(e);r+=`\n        <label class="tablix-filter-value-item">\n          <input type="checkbox" \n                 id="${`tablix-filter-value-${t}-${a}`}" \n                 name="filter-value-${t}" \n                 value="${this.escapeHtml(e)}" \n                 ${s?"checked":""}>\n          <span class="tablix-filter-value-text">${this.escapeHtml(e)}</span>\n        </label>\n      `}),r+="</div>",r}renderConditionFilterPanel(t,e){let a='<div class="tablix-filter-conditions">';return(e&&"condition"===e.type?e.config.conditions:[{operator:"none",value:""}]).forEach((t,e)=>{a+=this.renderConditionRow(t,e)}),a+='\n      </div>\n      <button class="tablix-filter-add-condition" type="button">+ Add Condition</button>\n    ',a}renderConditionRow(t,e){const a=this.filterManager.getOperators(),i=t.operator&&!["none","isEmpty","isNotEmpty"].includes(t.operator);let r=`\n      <div class="tablix-filter-condition" data-index="${e}">\n        <select class="tablix-filter-operator" \n                id="tablix-filter-operator-${e}" \n                name="filter-operator-${e}">\n    `;return Object.entries(a).forEach(([e,a])=>{r+=`<option value="${e}"${t.operator===e?" selected":""}>${a.label}</option>`}),r+=`\n        </select>\n        <input type="text" \n               id="tablix-filter-value-${e}" \n               name="filter-value-${e}"\n               class="tablix-filter-value" \n               placeholder="Value" \n               value="${this.escapeHtml(t.value||"")}"\n               ${i?"":"disabled"}>\n        <button class="tablix-filter-remove-condition" \n                type="button" \n                data-index="${e}"\n                title="Remove condition">×</button>\n      </div>\n    `,r}bindDropdownEvents(t,e){t.querySelectorAll(".tablix-filter-tab").forEach(e=>{e.addEventListener("click",e=>{this.switchTab(t,e.target.dataset.tab)})}),t.querySelector(".tablix-filter-close").addEventListener("click",()=>{this.closeAllDropdowns()}),t.querySelector(".tablix-filter-apply").addEventListener("click",()=>{this.applyFilter(t,e)}),t.querySelector(".tablix-filter-clear").addEventListener("click",()=>{this.clearFilter(e)}),t.querySelector(".tablix-filter-cancel").addEventListener("click",()=>{this.closeAllDropdowns()}),this.bindValueFilterEvents(t,e),this.bindConditionFilterEvents(t,e)}bindValueFilterEvents(t,e){const a=t.querySelector(".tablix-filter-value-panel");if(!a)return;const i=a.querySelector(".tablix-filter-search-input");if(i){let t;i.addEventListener("input",e=>{clearTimeout(t),t=setTimeout(()=>{this.filterValueList(a,e.target.value)},this.filterManager.options.debounceDelay||150)})}const r=a.querySelector(".tablix-filter-select-all-checkbox");r&&r.addEventListener("change",t=>{this.toggleSelectAll(a,t.target.checked)}),a.querySelectorAll('.tablix-filter-value-item input[type="checkbox"]').forEach(t=>{t.addEventListener("change",()=>{this.updateSelectAllState(a)})}),this.updateSelectAllState(a)}bindConditionFilterEvents(t,e){const a=t.querySelector(".tablix-filter-condition-panel");if(!a)return;const i=a.querySelector(".tablix-filter-add-condition");i&&i.addEventListener("click",()=>{this.addCondition(a)}),this.bindConditionRowEvents(a)}bindConditionRowEvents(t){t.querySelectorAll(".tablix-filter-operator").forEach(t=>{t.addEventListener("change",t=>{const e=t.target.parentElement.querySelector(".tablix-filter-value"),a=!["none","isEmpty","isNotEmpty"].includes(t.target.value);e.disabled=!a,a||(e.value="")})}),t.querySelectorAll(".tablix-filter-remove-condition").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const a=e.target.closest(".tablix-filter-condition");if(t.querySelector(".tablix-filter-conditions").querySelectorAll(".tablix-filter-condition").length>1)a.remove();else{const t=a.querySelector(".tablix-filter-operator"),e=a.querySelector(".tablix-filter-value");t.value="none",e.value="",e.disabled=!0}})})}switchTab(t,e){t.querySelectorAll(".tablix-filter-tab").forEach(t=>{t.classList.toggle("active",t.dataset.tab===e)}),t.querySelectorAll(".tablix-filter-panel").forEach(t=>{const a=t.classList.contains(`tablix-filter-${e}-panel`);t.classList.toggle("active",a)})}filterValueList(t,e){const a=t.querySelectorAll(".tablix-filter-value-item"),i=e.toLowerCase();a.forEach(t=>{const e=t.querySelector(".tablix-filter-value-text").textContent.toLowerCase().includes(i);t.style.display=e?"":"none"})}toggleSelectAll(t,e){t.querySelectorAll('.tablix-filter-value-item input[type="checkbox"]').forEach(t=>{"none"!==t.closest(".tablix-filter-value-item").style.display&&(t.checked=e)})}updateSelectAllState(t){const e=t.querySelector(".tablix-filter-select-all-checkbox");if(!e)return;const a=t.querySelectorAll('.tablix-filter-value-item input[type="checkbox"]'),i=Array.from(a).filter(t=>"none"!==t.closest(".tablix-filter-value-item").style.display),r=i.filter(t=>t.checked).length;e.checked=r>0&&r===i.length,e.indeterminate=r>0&&i.length>r}addCondition(t){const e=t.querySelector(".tablix-filter-conditions"),a=this.renderConditionRow({operator:"none",value:""},e.children.length);e.insertAdjacentHTML("beforeend",a);const i=e.lastElementChild;i.querySelector(".tablix-filter-operator").addEventListener("change",t=>{const e=t.target.parentElement.querySelector(".tablix-filter-value"),a=!["none","isEmpty","isNotEmpty"].includes(t.target.value);e.disabled=!a,a||(e.value="")});i.querySelector(".tablix-filter-remove-condition").addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const a=e.target.closest(".tablix-filter-condition");if(t.querySelector(".tablix-filter-conditions").querySelectorAll(".tablix-filter-condition").length>1)a.remove();else{const t=a.querySelector(".tablix-filter-operator"),e=a.querySelector(".tablix-filter-value");t.value="none",e.value="",e.disabled=!0}})}async applyFilter(t,e){let a;a="value"===t.querySelector(".tablix-filter-tab.active").dataset.tab?this.collectValueFilter(t):this.collectConditionFilter(t),await this.filterManager.applyFilter(e,a),this.closeAllDropdowns()}collectValueFilter(t){const e=t.querySelector(".tablix-filter-value-panel").querySelectorAll('.tablix-filter-value-item input[type="checkbox"]:checked');return{type:"value",values:Array.from(e).map(t=>t.value)}}collectConditionFilter(t){const e=t.querySelector(".tablix-filter-condition-panel").querySelectorAll(".tablix-filter-condition");return{type:"condition",conditions:Array.from(e).map(t=>({operator:t.querySelector(".tablix-filter-operator").value,value:t.querySelector(".tablix-filter-value").value})).filter(t=>"none"!==t.operator)}}async clearFilter(t){await this.filterManager.clearFilter(t),this.closeAllDropdowns()}showDropdown(t,e){document.body.appendChild(t);const a=e.getBoundingClientRect(),i=t.getBoundingClientRect();let r=a.left,s=a.bottom+5;r+i.width>window.innerWidth&&(r=window.innerWidth-i.width-10),s+i.height>window.innerHeight&&(s=a.top-i.height-5),t.style.left=Math.max(10,r)+"px",t.style.top=Math.max(10,s)+"px",t.style.display="block"}closeAllDropdowns(){this.activeDropdown&&(this.activeDropdown.dropdown.remove(),this.activeDropdown=null)}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}class c{constructor(t,e={}){this.table=t,this.options={enabled:!0,placeholder:"Search...",searchDelay:300,caseSensitive:!1,searchColumns:[],minLength:1,...e},this.options.placeholder||(this.options.placeholder="Search..."),this.currentSearchTerm="",this.searchTimeout=null,this.originalData=null,this.handleSearchInput=this.handleSearchInput.bind(this),this.handleSearchClear=this.handleSearchClear.bind(this)}init(){this.originalData=this.table.dataManager.originalData,this.table.eventManager.on("afterLoad",t=>{this.originalData=t.data||t.source,this.currentSearchTerm&&this.performSearch(this.currentSearchTerm)})}bindEvents(){const t=this.table.container.querySelector(".tablix-search-input"),e=this.table.container.querySelector(".tablix-search-clear");t&&(this.currentSearchTerm&&t.value!==this.currentSearchTerm&&(t.value=this.currentSearchTerm),t.addEventListener("input",this.handleSearchInput),t.addEventListener("keydown",t=>{"Escape"===t.key&&this.clearSearch()})),e&&e.addEventListener("click",this.handleSearchClear),this.updateClearButtonVisibility()}handleSearchInput(t){const e=t.target.value;this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.performSearch(e)},this.options.searchDelay)}handleSearchClear(t){t.preventDefault(),this.clearSearch()}async performSearch(t){const e=this.currentSearchTerm,a=this.table.container.querySelector(".tablix-search-input"),i=a&&document.activeElement===a,r=a&&a.selectionStart||0;if(this.table.eventManager.trigger("beforeSearch",{searchTerm:t,previousTerm:e,minLength:this.options.minLength,searchDelay:this.options.searchDelay,willSearch:t.length>=this.options.minLength}),this.currentSearchTerm=t,this.options.minLength>t.length)this.table.dataManager.filteredData=[...this.originalData];else{const e=this.filterData(t);this.table.dataManager.filteredData=e}this.table.paginationManager&&this.table.paginationManager.resetToFirstPage(),await this.table.refreshTable(),i&&requestAnimationFrame(()=>{const t=this.table.container.querySelector(".tablix-search-input");t&&(t.focus(),r>0&&t.value.length>=r&&t.setSelectionRange(r,r))});const s={searchTerm:t,previousTerm:e,resultsCount:this.table.dataManager.filteredData.length,totalCount:this.originalData.length,isActive:this.isSearchActive(),searchPerformed:t.length>=this.options.minLength};this.table.eventManager.trigger("afterSearch",s),this.updateClearButtonVisibility()}filterData(t){if(!t||""===t.trim())return[...this.originalData];const e=this.options.caseSensitive?t:t.toLowerCase(),a=this.getSearchableColumns();return this.originalData.filter(t=>a.some(a=>{const i=t[a];if(null==i)return!1;return(this.options.caseSensitive?i+"":(i+"").toLowerCase()).includes(e)}))}getSearchableColumns(){if(this.options.searchColumns&&this.options.searchColumns.length>0)return this.options.searchColumns;return(this.table.columnManager?this.table.columnManager.getColumns():this.table.options.columns||[]).map(t=>t.name||t.key).filter(t=>t)}async clearSearch(){this.updateInputValue(""),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),await this.performSearch("")}updateClearButtonVisibility(){const t=this.table.container.querySelector(".tablix-search-clear");t&&(t.style.display=this.currentSearchTerm?"block":"none")}updateInputValue(t){const e=this.table.container.querySelector(".tablix-search-input");e&&e.value!==t&&(e.value=t)}async setSearchTerm(t){this.updateInputValue(t),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),await this.performSearch(t)}getSearchTerm(){return this.currentSearchTerm}isSearchActive(){return this.currentSearchTerm&&this.currentSearchTerm.length>=this.options.minLength}getSearchInfo(){return{searchTerm:this.currentSearchTerm,resultsCount:this.table.dataManager.filteredData.length,totalCount:this.originalData.length,isActive:this.isSearchActive()}}configure(t){const e={...this.options};if(this.options={...this.options,...t},this.options.placeholder||(this.options.placeholder="Search..."),t.placeholder&&t.placeholder!==e.placeholder){const t=this.table.container.querySelector(".tablix-search-input");t&&(t.placeholder=this.options.placeholder)}void 0!==t.minLength&&this.currentSearchTerm&&this.performSearch(this.currentSearchTerm)}getConfiguration(){return{...this.options}}destroy(){this.searchTimeout&&clearTimeout(this.searchTimeout);const t=this.table.container.querySelector(".tablix-search-input"),e=this.table.container.querySelector(".tablix-search-clear");t&&t.removeEventListener("input",this.handleSearchInput),e&&e.removeEventListener("click",this.handleSearchClear)}}class h{constructor(t,e={}){this.table=t,this.options={enabled:!1,mode:"single",...e},this.selectedRows=new Set,this.lastSelectedRow=null,this.rowIdMap=new Map,this.dataIdKey=e.dataIdKey||"id",this.dragSelection={isActive:!1,startRowIndex:null,currentRowIndex:null,startRowId:null,originalSelection:null,isDragging:!1,dragThreshold:3},this.init()}init(){this.eventListenersSetup=!1,this.options.enabled&&this.setupEventListeners()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.table.eventManager.on("rowClick",t=>{this.handleRowClick(t)}),"multi"!==this.options.mode||this.table.virtualScrollManager||this.setupDragSelection(),this.table.eventManager.on("beforeLoad",()=>{this.clearSelection()}),this.table.eventManager.on("afterLoad",()=>{this.updateSelectionAfterDataChange()}),this.table.eventManager.on("afterRender",()=>{this.updateUI()}))}handleRowClick(t){if(!this.options.enabled)return;if(this.dragSelection.isDragging)return void(this.dragSelection.isDragging=!1);const{rowData:e,originalEvent:a}=t,i=this.getRowId(e);console.log("SelectionManager handleRowClick:",{rowId:i,hasOriginalEvent:!!a,ctrlKey:a?a.ctrlKey:"no event",shiftKey:a?a.shiftKey:"no event",metaKey:a?a.metaKey:"no event",timestamp:Date.now()}),a&&(a.preventDefault(),a.stopPropagation());const r={rowData:e,rowId:i,currentSelection:Array.from(this.selectedRows),isCtrlClick:a&&(a.ctrlKey||a.metaKey),isShiftClick:a&&a.shiftKey,isDragSelection:!1};this.table.eventManager.trigger("beforeSelect",r),"single"===this.options.mode?this.handleSingleSelection(i,e):"multi"===this.options.mode&&this.handleMultiSelection(i,e,a),this.updateUI();const s={rowData:e,rowId:i,selectedRows:Array.from(this.selectedRows),selectedData:this.getSelectedData(),isDragSelection:!1};this.table.eventManager.trigger("afterSelect",s)}handleSingleSelection(t,e){this.selectedRows.has(t)?(this.selectedRows.clear(),this.lastSelectedRow=null):(this.selectedRows.clear(),this.selectedRows.add(t),this.lastSelectedRow=t)}handleMultiSelection(t,e,a){const i=a&&(a.ctrlKey||a.metaKey),r=a&&a.shiftKey;console.log("handleMultiSelection DETAILED:",{rowId:t,isCtrlClick:i,isShiftClick:r,"originalEvent.ctrlKey":a?a.ctrlKey:"no event","originalEvent.metaKey":a?a.metaKey:"no event","originalEvent.shiftKey":a?a.shiftKey:"no event",lastSelectedRow:this.lastSelectedRow,currentSelection:Array.from(this.selectedRows),selectionSize:this.selectedRows.size}),r&&this.lastSelectedRow?(console.log("Executing range selection from",this.lastSelectedRow,"to",t),this.handleRangeSelection(t)):i?(console.log("Executing ctrl+click toggle for",t),this.selectedRows.has(t)?(this.selectedRows.delete(t),console.log("Ctrl+click: Deselected",t),this.lastSelectedRow=this.selectedRows.size>0?Array.from(this.selectedRows)[0]:null):(this.selectedRows.add(t),this.lastSelectedRow=t,console.log("Ctrl+click: Added",t,"to selection. Total selected:",this.selectedRows.size))):(console.log("Executing normal click for",t),this.selectedRows.clear(),this.selectedRows.add(t),this.lastSelectedRow=t,console.log("Normal click: Selected only",t))}handleRangeSelection(t){const e=this.getFullData(),a=e.findIndex(t=>this.getRowId(t)===this.lastSelectedRow),i=e.findIndex(e=>this.getRowId(e)===t);if(-1===a||-1===i)return this.selectedRows.clear(),this.selectedRows.add(t),void(this.lastSelectedRow=t);const r=Math.min(a,i),s=Math.max(a,i);for(let t=r;s>=t;t++){const a=this.getRowId(e[t]);this.selectedRows.add(a)}}setupDragSelection(){const t=this.table.container;if(!t)return;let e,a;t.addEventListener("mousedown",t=>{if(!this.options.enabled||"multi"!==this.options.mode)return;const i=t.target.closest(".tablix-row");if(!i||i.classList.contains("tablix-empty-row"))return;const r=parseInt(i.dataset.rowIndex,10);if(isNaN(r))return;if(t.ctrlKey||t.metaKey||t.shiftKey)return;e=t.clientX,a=t.clientY,this.dragSelection.isActive=!0,this.dragSelection.startRowIndex=r,this.dragSelection.currentRowIndex=r,this.dragSelection.isDragging=!1,this.dragSelection.originalSelection=new Set(this.selectedRows);const s=this.getFullData();s.length>r&&(this.dragSelection.startRowId=this.getRowId(s[r])),t.preventDefault()}),t.addEventListener("mousemove",t=>{if(!this.dragSelection.isActive)return;this.dragSelection.isDragging||this.dragSelection.dragThreshold>=Math.abs(t.clientX-e)&&this.dragSelection.dragThreshold>=Math.abs(t.clientY-a)||(this.dragSelection.isDragging=!0,this.startDragSelection()),this.dragSelection.isDragging&&this.updateDragSelection(t)}),t.addEventListener("mouseup",t=>{this.dragSelection.isActive&&this.completeDragSelection()}),t.addEventListener("mouseleave",t=>{this.dragSelection.isActive&&this.cancelDragSelection()}),t.addEventListener("selectstart",t=>{this.dragSelection.isDragging&&t.preventDefault()})}startDragSelection(){const t=this.table.container.querySelector(".tablix-wrapper");t&&t.classList.add("tablix-drag-selecting");const e=this.getFullData();if(e.length>this.dragSelection.startRowIndex){const t={rowData:e[this.dragSelection.startRowIndex],rowId:this.dragSelection.startRowId,currentSelection:Array.from(this.selectedRows),isCtrlClick:!1,isShiftClick:!1,isDragSelection:!0,dragStart:!0};this.table.eventManager.trigger("beforeSelect",t)}}updateDragSelection(t){const e=t.target.closest(".tablix-row");if(!e||e.classList.contains("tablix-empty-row"))return;const a=parseInt(e.dataset.rowIndex,10);isNaN(a)||a!==this.dragSelection.currentRowIndex&&(this.dragSelection.currentRowIndex=a,this.applyDragSelection())}applyDragSelection(){const t=this.getFullData(),e=this.dragSelection.startRowIndex,a=this.dragSelection.currentRowIndex,i=Math.min(e,a),r=Math.max(e,a);this.selectedRows=new Set(this.dragSelection.originalSelection);for(let e=i;r>=e;e++)if(t.length>e){const a=this.getRowId(t[e]);this.selectedRows.add(a)}t.length>a&&(this.lastSelectedRow=this.getRowId(t[a])),this.updateUI()}completeDragSelection(){const t=this.table.container.querySelector(".tablix-wrapper");if(t&&t.classList.remove("tablix-drag-selecting"),this.dragSelection.isDragging){const t={selectedRows:Array.from(this.selectedRows),selectedData:this.getSelectedData(),isDragSelection:!0,dragComplete:!0};this.table.eventManager.trigger("afterSelect",t)}this.resetDragSelection()}cancelDragSelection(){const t=this.table.container.querySelector(".tablix-wrapper");t&&t.classList.remove("tablix-drag-selecting"),this.selectedRows=new Set(this.dragSelection.originalSelection),this.updateUI(),this.resetDragSelection()}resetDragSelection(){this.dragSelection.isActive=!1,this.dragSelection.startRowIndex=null,this.dragSelection.currentRowIndex=null,this.dragSelection.startRowId=null,this.dragSelection.originalSelection=null,this.dragSelection.isDragging=!1}getRowId(t){return void 0!==t[this.dataIdKey]?t[this.dataIdKey]+"":this.createRowHash(t)}createRowHash(t){const e=JSON.stringify(t);let a=0;for(let t=0;e.length>t;t++){a=(a<<5)-a+e.charCodeAt(t),a&=a}return a+""}getCurrentPageData(){return this.table.virtualScrollManager?this.table.dataManager.getData():this.table.paginationManager?this.table.paginationManager.getCurrentPageData()||[]:this.table.dataManager.getData()}getFullData(){return this.table.dataManager.getData()}updateUI(){if(!this.options.enabled)return;const t=this.table.container.querySelector(".tablix-table");if(!t)return;const e=t.querySelectorAll(".tablix-row");e.forEach(t=>{t.classList.remove("tablix-selected","tablix-last-selected")});if(e.length>0&&e[0].hasAttribute("data-virtual-index")){const t=this.getFullData();e.forEach(e=>{const a=parseInt(e.getAttribute("data-virtual-index"));if(!isNaN(a)&&t.length>a){const i=this.getRowId(t[a]);this.selectedRows.has(i)&&(e.classList.add("tablix-selected"),i===this.lastSelectedRow&&e.classList.add("tablix-last-selected"))}})}else{const t=this.getFullData();e.forEach(e=>{const a=e.hasAttribute("data-row-index")?parseInt(e.getAttribute("data-row-index")):-1;if(a>=0&&t.length>a){const i=this.getRowId(t[a]);this.selectedRows.has(i)&&(e.classList.add("tablix-selected"),i===this.lastSelectedRow&&e.classList.add("tablix-last-selected"))}})}}updateSelectionAfterDataChange(){if(this.options.enabled)if(this.table.virtualScrollManager)this.updateUI();else{const t=this.getFullData(),e=new Set(t.map(t=>this.getRowId(t))),a=new Set;this.selectedRows.forEach(t=>{e.has(t)&&a.add(t)}),this.selectedRows=a,this.lastSelectedRow&&!e.has(this.lastSelectedRow)&&(this.lastSelectedRow=this.selectedRows.size>0?Array.from(this.selectedRows)[0]:null),this.updateUI()}}getSelectedData(){if(!this.options.enabled||0===this.selectedRows.size)return[];return this.getFullData().filter(t=>this.selectedRows.has(this.getRowId(t)))}getSelectedIds(){return Array.from(this.selectedRows)}selectRows(t){if(!this.options.enabled)return;const e=Array.isArray(t)?t:[t];"single"===this.options.mode&&e.length>1?console.warn("SelectionManager: Cannot select multiple rows in single mode"):("single"===this.options.mode&&this.selectedRows.clear(),e.forEach(t=>{this.selectedRows.add(t+"")}),e.length>0&&(this.lastSelectedRow=e[e.length-1]+""),this.updateUI(),this.table.eventManager.trigger("afterSelect",{selectedRows:Array.from(this.selectedRows),selectedData:this.getSelectedData()}))}deselectRows(t){if(!this.options.enabled)return;const e=Array.isArray(t)?t:[t];e.forEach(t=>{this.selectedRows.delete(t+"")}),e.includes(this.lastSelectedRow)&&(this.lastSelectedRow=this.selectedRows.size>0?Array.from(this.selectedRows)[0]:null),this.updateUI(),this.table.eventManager.trigger("afterSelect",{selectedRows:Array.from(this.selectedRows),selectedData:this.getSelectedData()})}clearSelection(){if(!this.options.enabled)return;const t=this.selectedRows.size>0;this.selectedRows.clear(),this.lastSelectedRow=null,this.updateUI(),t&&this.table.eventManager.trigger("afterSelect",{selectedRows:[],selectedData:[]})}isRowSelected(t){return this.selectedRows.has(t+"")}isRowSelectedByData(t){const e=this.getRowId(t);return this.selectedRows.has(e+"")}getSelectionCount(){return this.selectedRows.size}enable(){this.options.enabled=!0,this.eventListenersSetup||this.setupEventListeners()}disable(){this.options.enabled=!1,this.clearSelection()}setMode(t){if("single"!==t&&"multi"!==t)return void console.warn('SelectionManager: Invalid mode. Use "single" or "multi"');const e=this.options.mode;if(this.options.mode=t,"single"===t&&this.selectedRows.size>1){const t=this.lastSelectedRow;this.selectedRows.clear(),t&&this.selectedRows.add(t),this.updateUI()}e!==t&&this.options.enabled&&"multi"===t&&this.setupDragSelection()}destroy(){this.clearSelection()}}class d{constructor(t,e={}){this.table=t,this.options={enabled:!1,buffer:10,rowHeight:null,throttleDelay:8,...e},this.scrollContainer=null,this.tableBody=null,this.topSpacer=null,this.bottomSpacer=null,this.rowHeight=this.options.rowHeight||35,this.containerHeight=0,this.totalRows=0,this.visibleStart=0,this.visibleEnd=0,this.renderedStart=0,this.renderedEnd=0,this.performanceData={renderTimes:[],scrollUpdates:0,lastMeasurement:0},this.throttledScrollHandler=this.throttle(this.handleScroll.bind(this),this.options.throttleDelay),this.immediateScrollHandler=this.handleScroll.bind(this),this.updateScheduled=!1,this.pendingUpdate=!1,this.lastScrollTime=0,this.scrollVelocity=0,this.data=[],this.renderedData=[]}init(t=[]){this.options.enabled&&(this.data=t,this.totalRows=t.length,this.setupScrollContainer(),this.detectRowHeight(),this.calculateViewport(),this.scheduleUpdate(),this.scrollContainer.addEventListener("scroll",this.handleScrollImmediate.bind(this),{passive:!0}),this.scrollContainer.addEventListener("scroll",this.throttledScrollHandler,{passive:!0}),this.scrollContainer.addEventListener("mousedown",this.handleScrollStart.bind(this)),document.addEventListener("mouseup",this.handleScrollEnd.bind(this)),window.addEventListener("resize",this.throttle(this.handleResize.bind(this),100)),this.setupEventDelegation(),this.setupSelectionListeners(),this.log("Virtual scroll initialized",{totalRows:this.totalRows,rowHeight:this.rowHeight,buffer:this.options.buffer}))}setupEventDelegation(){this.scrollContainer&&this.table.eventManager&&(this.rowClickHandler=t=>{const e=t.target.closest(".tablix-row");if(!e)return;if(this.justFinishedDrag)return void console.log("Skipping click - just finished drag");const a=parseInt(e.getAttribute("data-virtual-index")),i=this.data[a];i&&(console.log("VirtualScroll rowClickHandler triggered:",{virtualIndex:a,rowId:i.id,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,eventType:t.type,timestamp:Date.now()}),this.table.eventManager.trigger("rowClick",{rowData:i,rowIndex:a,originalEvent:t,element:e}),setTimeout(()=>this.updateSelectionStates(),0))},this.scrollContainer.addEventListener("click",this.rowClickHandler),this.table.selectionManager&&this.table.selectionManager.options.enabled&&"multi"===this.table.selectionManager.options.mode&&this.setupVirtualDragSelection(),this.rowHoverHandler=t=>{const e=t.target.closest(".tablix-row");if(!e)return;const a=parseInt(e.getAttribute("data-virtual-index")),i=this.data[a];i&&this.table.eventManager.trigger("rowHover",{rowData:i,rowIndex:a,originalEvent:t,element:e})},this.scrollContainer.addEventListener("mouseover",this.rowHoverHandler))}setupSelectionListeners(){this.table.eventManager&&(this.table.eventManager.on("afterSelect",()=>{this.updateSelectionStates()}),this.table.eventManager.on("selectionCleared",()=>{this.updateSelectionStates()}))}setupScrollContainer(){const t=this.table.container.querySelector(".tablix-wrapper");if(!t)throw Error("Table wrapper not found for virtual scrolling");let e=t.querySelector(".tablix-scroll-container");e||(e=t.querySelector(".tablix-scroll-container"),e)?(this.scrollContainer=e,this.tableBody=e.querySelector(".tablix-tbody"),this.createSpacers()):console.warn("Scroll container not found - virtual scrolling may not work properly")}createSpacers(){if(!this.tableBody)return;const t=this.tableBody.querySelector(".tablix-top-spacer"),e=this.tableBody.querySelector(".tablix-bottom-spacer");t&&t.remove(),e&&e.remove(),this.topSpacer=document.createElement("tr"),this.topSpacer.className="tablix-top-spacer",this.topSpacer.style.cssText="height: 0px; border: none;",this.topSpacer.innerHTML='<td colspan="100" style="padding: 0; border: none; height: 0;"></td>',this.bottomSpacer=document.createElement("tr"),this.bottomSpacer.className="tablix-bottom-spacer",this.bottomSpacer.style.cssText="height: 0px; border: none;",this.bottomSpacer.innerHTML='<td colspan="100" style="padding: 0; border: none; height: 0;"></td>',this.tableBody.insertBefore(this.topSpacer,this.tableBody.firstChild),this.tableBody.appendChild(this.bottomSpacer)}detectRowHeight(){if(this.options.rowHeight)return void(this.rowHeight=this.options.rowHeight);if(!this.tableBody||0===this.data.length)return;const t=this.renderSingleRow(this.data[0],0);this.tableBody.appendChild(t);const e=t.getBoundingClientRect();this.rowHeight=Math.max(e.height,25),t.remove(),this.log("Row height detected",{rowHeight:this.rowHeight})}calculateViewport(){if(!this.scrollContainer)return;const t=this.scrollContainer.getBoundingClientRect();this.containerHeight=t.height;const e=this.scrollContainer.scrollTop,a=Math.ceil(this.containerHeight/this.rowHeight);this.visibleStart=Math.floor(e/this.rowHeight),this.visibleEnd=Math.min(this.visibleStart+a,this.totalRows),this.renderedStart=Math.max(0,this.visibleStart-this.options.buffer),this.renderedEnd=Math.min(this.totalRows,this.visibleEnd+this.options.buffer),this.updateSpacers()}updateSpacers(){if(!this.topSpacer||!this.bottomSpacer)return;const t=(this.totalRows-this.renderedEnd)*this.rowHeight;this.topSpacer.style.height=this.renderedStart*this.rowHeight+"px",this.bottomSpacer.style.height=t+"px"}handleScrollImmediate(){const t=performance.now(),e=this.scrollContainer.scrollTop;if(this.lastScrollTime&&void 0!==this.lastScrollTop){const a=t-this.lastScrollTime;this.scrollVelocity=a>0?Math.abs(e-this.lastScrollTop)/a:0}this.lastScrollTime=t,this.lastScrollTop=e,this.scrollVelocity>2&&this.scheduleUpdate()}handleScrollStart(t){const e=t.target;e.closest(".tablix-row")||e.closest(".tablix-table")||(this.isScrollbarDragging=!0,this.scrollDragInterval=setInterval(()=>{this.isScrollbarDragging&&this.scheduleUpdate()},8))}handleScrollEnd(){this.isScrollbarDragging=!1,this.scrollDragInterval&&(clearInterval(this.scrollDragInterval),this.scrollDragInterval=null),this.scheduleUpdate()}setupVirtualDragSelection(){let t=!1,e=null,a=null,i=null,r=null;this.justFinishedDrag=!1,this.scrollContainer.addEventListener("mousedown",s=>{if(s.ctrlKey||s.metaKey||s.shiftKey)return;const n=s.target.closest(".tablix-row");if(!n||n.classList.contains("tablix-empty-row"))return;const l=parseInt(n.getAttribute("data-virtual-index"));isNaN(l)||(e=l,a=s.clientX,i=s.clientY,t=!1,r=new Set(this.table.selectionManager.selectedRows))}),this.scrollContainer.addEventListener("mousemove",s=>{if(null===e)return;if(t||3>=Math.abs(s.clientX-a)&&3>=Math.abs(s.clientY-i)||(t=!0,this.scrollContainer.classList.add("tablix-drag-selecting")),t){const t=s.target.closest(".tablix-row");if(t){const a=parseInt(t.getAttribute("data-virtual-index"));isNaN(a)||this.applyVirtualDragSelection(e,a,r)}}});const s=a=>{if(null!==e){if(this.scrollContainer.classList.remove("tablix-drag-selecting"),!t)return e=null,t=!1,void(r=null);this.table.eventManager.trigger("afterSelect",{selectedRows:Array.from(this.table.selectionManager.selectedRows),selectedData:this.table.selectionManager.getSelectedData(),isDragSelection:!0,dragComplete:!0}),this.justFinishedDrag=!0,setTimeout(()=>{this.justFinishedDrag=!1},50),e=null,t=!1,r=null}};document.addEventListener("mouseup",s),this.scrollContainer.addEventListener("mouseleave",s),this.scrollContainer.addEventListener("selectstart",e=>{t&&e.preventDefault()})}applyVirtualDragSelection(t,e,a){const i=Math.min(t,e),r=Math.max(t,e);this.table.selectionManager.selectedRows=new Set(a);for(let t=i;r>=t;t++)if(this.data.length>t){const e=this.table.selectionManager.getRowId(this.data[t]);this.table.selectionManager.selectedRows.add(e)}if(this.data.length>e){this.table.selectionManager.lastSelectedRow=this.table.selectionManager.getRowId(this.data[e])}this.table.selectionManager.updateUI()}handleScroll(){this.options.enabled&&!this.updateScheduled&&this.scheduleUpdate()}handleResize(){this.options.enabled&&(this.calculateViewport(),this.scheduleUpdate())}scheduleUpdate(){this.updateScheduled||(this.updateScheduled=!0,requestAnimationFrame(()=>{this.update(),this.updateScheduled=!1}))}update(){const t=performance.now();this.calculateViewport(),this.renderVisibleRows();const e=performance.now();this.trackPerformance(e-t),this.performanceData.scrollUpdates++}renderVisibleRows(){if(!this.tableBody)return;this.tableBody.querySelectorAll(".tablix-row").forEach(t=>t.remove());const t=document.createDocumentFragment();for(let e=this.renderedStart;this.renderedEnd>e;e++)if(this.data.length>e){const a=this.renderSingleRow(this.data[e],e);t.appendChild(a)}this.tableBody.insertBefore(t,this.bottomSpacer),this.renderedData=this.data.slice(this.renderedStart,this.renderedEnd),this.handleImageLoading(),this.updateSelectionStates()}updateSelectionStates(){if(!this.table.selectionManager||!this.tableBody)return;this.tableBody.querySelectorAll(".tablix-row").forEach(t=>{const e=parseInt(t.getAttribute("data-virtual-index")),a=this.data[e];a&&this.table.selectionManager.isRowSelectedByData(a)?t.classList.add("tablix-selected"):t.classList.remove("tablix-selected")})}handleImageLoading(){if(!this.tableBody)return;this.tableBody.querySelectorAll(".tablix-row img").forEach((t,e)=>{if(t.complete||t.classList.contains("loading"))return;t.classList.add("loading");const a=t.cloneNode();a.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjZjBmMGYwIi8+CjxwYXRoIGQ9Ik0xNiA4TDIwIDEySDEyTDE2IDhaIiBmaWxsPSIjY2NjY2NjIi8+CjxwYXRoIGQ9Ik04IDIwSDI0VjE2SDhWMjBaIiBmaWxsPSIjY2NjY2NjIi8+Cjwvc3ZnPgo=",a.classList.add("image-placeholder");const i=()=>{t.classList.remove("loading"),t.style.opacity="1",t.removeEventListener("load",i),t.removeEventListener("error",r)},r=()=>{t.classList.remove("loading"),t.src=a.src,t.removeEventListener("load",i),t.removeEventListener("error",r)};t.addEventListener("load",i),t.addEventListener("error",r),t.style.opacity="0.5",t.style.transition="opacity 0.2s ease"})}renderSingleRow(t,e){const a=this.table.columnManager?this.table.columnManager.getColumns():this.table.options.columns||[],i=document.createElement("tr");i.className="tablix-row",i.setAttribute("data-row-index",e),i.setAttribute("data-virtual-index",e),i.setAttribute("data-row-id",this.table.selectionManager?this.table.selectionManager.getRowId(t):e);return this.table.selectionManager&&this.table.selectionManager.isRowSelectedByData(t)&&(i.classList.add("tablix-selected"),console.log("Row initially selected:",e,t.id)),a.forEach(e=>{const a=document.createElement("td");a.className="tablix-td";const r=t[e.name];if(this.table.columnManager){const i=this.table.columnManager.formatCellValue(e.name,r,t);i.isHtml?a.innerHTML=i.value:a.textContent=i.value}else if(e.renderer&&"function"==typeof e.renderer){const i=e.renderer(r,t);"string"==typeof i&&i.includes("<")?a.innerHTML=i:a.textContent=i}else a.textContent=null!=r?r+"":"";i.appendChild(a)}),i}updateData(t){this.data=t,this.totalRows=t.length,this.options.enabled&&(this.calculateViewport(),this.scheduleUpdate())}scrollToRow(t){if(!this.scrollContainer||!this.options.enabled)return;this.scrollContainer.scrollTop=t*this.rowHeight,this.update()}getVisibleRange(){return{start:this.visibleStart,end:this.visibleEnd,renderedStart:this.renderedStart,renderedEnd:this.renderedEnd}}getRenderedData(){return this.renderedData}isEnabled(){return this.options.enabled}setEnabled(t){this.options.enabled=t,t&&this.data.length>0&&this.init(this.data)}trackPerformance(t){this.performanceData.renderTimes.push(t),this.performanceData.lastMeasurement=t,this.performanceData.renderTimes.length>100&&this.performanceData.renderTimes.shift()}getPerformanceStats(){const t=this.performanceData.renderTimes;if(0===t.length)return null;const e=t.reduce((t,e)=>t+e,0)/t.length,a=Math.max(...t),i=Math.min(...t);return{averageRenderTime:e.toFixed(2),maxRenderTime:a.toFixed(2),minRenderTime:i.toFixed(2),scrollUpdates:this.performanceData.scrollUpdates,totalRows:this.totalRows,visibleRows:this.visibleEnd-this.visibleStart,renderedRows:this.renderedEnd-this.renderedStart}}throttle(t,e){let a;return function(){a||(t.apply(this,arguments),a=!0,setTimeout(()=>a=!1,e))}}log(t,e={}){this.table.options.debug&&console.log("[VirtualScroll] "+t,e)}destroy(){this.scrollContainer&&(this.scrollContainer.removeEventListener("scroll",this.throttledScrollHandler),this.scrollContainer.removeEventListener("scroll",this.handleScrollImmediate),this.scrollContainer.removeEventListener("mousedown",this.handleScrollStart)),document.removeEventListener("mouseup",this.handleScrollEnd),window.removeEventListener("resize",this.handleResize),this.scrollDragInterval&&(clearInterval(this.scrollDragInterval),this.scrollDragInterval=null),this.scrollContainer=null,this.tableBody=null,this.topSpacer=null,this.bottomSpacer=null}}class g{constructor(t,g={}){this.container="string"==typeof t?document.querySelector(t):t,this.options={pagination:{enabled:!0,pageSize:10,mode:"client",showPageNumbers:!0,maxPageNumbers:5,showFirstLast:!0,showPrevNext:!0,showPageSizes:!1,pageSizeOptions:[10,25,50,100],serverDataLoader:null},sorting:{enabled:!0,mode:"client",serverSortLoader:null,defaultSortType:"auto",caseSensitive:!1,nullsFirst:!1},filtering:{enabled:!0,mode:"client",serverFilterLoader:null,debounceDelay:300,showBadges:!0,showTooltips:!0},controls:{enabled:!0,search:!0,pagination:!0,pageSize:!0,refresh:!0,export:!1,position:"top"},search:{enabled:!0,placeholder:"Search...",searchDelay:300,minLength:1,caseSensitive:!1},selection:{enabled:!1,mode:"single",dataIdKey:"id"},virtualScroll:{enabled:!1,buffer:10,rowHeight:null,containerHeight:400},...g},this.eventManager=new i,this.columnManager=new n(this),this.dataManager=new e(this,g.data||[]),this.renderer=new a(this),g.columns&&this.columnManager.initializeColumns(g.columns),this.options.pagination&&!1!==this.options.pagination.enabled&&(this.paginationManager=new r(this,this.options.pagination)),this.options.sorting&&!1!==this.options.sorting.enabled&&(this.sortingManager=new s(this,this.options.sorting)),this.options.filtering&&!1!==this.options.filtering.enabled&&(this.filterManager=new l(this,this.options.filtering),this.filterUI=new o(this.filterManager)),this.options.search&&!1!==this.options.search.enabled&&(this.searchManager=new c(this,this.options.search)),this.options.selection&&(this.selectionManager=new h(this,this.options.selection)),this.options.virtualScroll&&(this.virtualScrollManager=new d(this,this.options.virtualScroll)),this.init()}async init(){try{this.searchManager&&this.searchManager.init();const t=this.dataManager.getData();this.eventManager.trigger("beforeLoad",{source:t}),await this.refreshTable(),this.eventManager.trigger("afterLoad",{data:t,source:t})}catch(t){console.error("Failed to initialize table:",t),this.eventManager.trigger("loadError",{error:t,source:"initialization"}),this.renderer&&this.renderer.renderError&&this.renderer.renderError(t)}}async refreshTable(){let t;this.virtualScrollManager&&this.virtualScrollManager.isEnabled()?(t=this.dataManager.getData(),this.virtualScrollManager.updateData(t),this.renderer.renderTable([],!0),this.virtualScrollManager.init(t)):this.paginationManager?(t=await this.paginationManager.getPageData(),this.renderer.renderTable(t)):(t=this.dataManager.getData(),this.renderer.renderTable(t))}async loadData(t){try{let e;if(this.eventManager.trigger("beforeLoad",{source:t}),Array.isArray(t))e=t;else if("string"==typeof t)e=await this._fetchFromUrl(t);else{if("function"!=typeof t)throw Error("Invalid data source. Expected array, URL string, or function.");e=await t()}if(!Array.isArray(e))throw Error("Data source must resolve to an array.");this.dataManager.setData(e),await this.refreshTable(),this.eventManager.trigger("afterLoad",{data:e,source:t})}catch(e){throw console.error("Error loading data:",e),this.eventManager.trigger("loadError",{error:e,source:t}),this.renderer&&this.renderer.renderError&&this.renderer.renderError(e),e}}async _fetchFromUrl(t){if("undefined"==typeof fetch)throw Error("fetch is not available. Please use a modern browser or provide a polyfill.");const e=await fetch(t);if(!e.ok)throw Error(`HTTP error! status: ${e.status} - ${e.statusText}`);return await e.json()}async filter(t){this.dataManager.applyFilter(t),await this.refreshTable(),this.eventManager.trigger("afterFilter",t)}async sort(t,e="asc"){this.sortingManager?await this.sortingManager.sort(t,e):(this.dataManager.applySorting([{column:t,direction:e}]),await this.refreshTable(),this.eventManager.trigger("afterSort",[{column:t,direction:e}]))}async toggleSort(t){this.sortingManager&&await this.sortingManager.toggleSort(t)}async clearSorting(){this.sortingManager?await this.sortingManager.clearSorting():(this.dataManager.clearSorting(),await this.refreshTable(),this.eventManager.trigger("afterSort",[]))}getSortState(){return this.sortingManager?this.sortingManager.getSortState():{sort:null,mode:"client"}}async clearFilters(){this.dataManager.clearFilters(),await this.refreshTable(),this.eventManager.trigger("afterFilter",{})}async clearSorting(){this.sortingManager?await this.sortingManager.clearSorting():(this.dataManager.clearSorting(),await this.refreshTable(),this.eventManager.trigger("afterSort",[]))}async applyFilter(t,e){this.filterManager?await this.filterManager.applyFilter(t,e):console.warn("TablixJS: Filtering is not enabled. Set filtering.enabled to true in options.")}async clearFilter(t){this.filterManager&&await this.filterManager.clearFilter(t)}async clearAllFilters(){this.filterManager?await this.filterManager.clearAllFilters():(this.dataManager.clearFilters(),await this.refreshTable(),this.eventManager.trigger("afterFilter",{}))}getActiveFilters(){return this.filterManager?this.filterManager.getActiveFilters():{}}getColumnFilter(t){return this.filterManager?this.filterManager.getColumnFilter(t):null}async setSearchTerm(t){this.searchManager?await this.searchManager.setSearchTerm(t):console.warn("TablixJS: Search is not enabled. Set search.enabled to true in options.")}getSearchTerm(){return this.searchManager?this.searchManager.getSearchTerm():""}async clearSearch(){this.searchManager&&await this.searchManager.clearSearch()}getSearchInfo(){return this.searchManager?this.searchManager.getSearchInfo():null}async nextPage(){this.paginationManager&&await this.paginationManager.nextPage()}async prevPage(){this.paginationManager&&await this.paginationManager.prevPage()}async firstPage(){this.paginationManager&&await this.paginationManager.firstPage()}async lastPage(){this.paginationManager&&await this.paginationManager.lastPage()}async goToPage(t){this.paginationManager&&await this.paginationManager.goToPage(t)}async changePageSize(t){this.paginationManager&&await this.paginationManager.changePageSize(t)}getPaginationInfo(){return this.paginationManager?this.paginationManager.getInfo():null}async setPaginationEnabled(t){this.paginationManager?(this.paginationManager.setEnabled(t),await this.refreshTable()):t&&(this.paginationManager=new r(this,this.options.pagination),await this.refreshTable())}async setPaginationMode(t,e=null){this.paginationManager&&await this.paginationManager.setMode(t,e)}on(t,e){this.eventManager.on(t,e)}off(t,e){this.eventManager.off(t,e)}clearEvents(t){this.eventManager.clear(t)}trigger(t,e){this.eventManager.trigger(t,e)}getData(){return this.dataManager.getData()}getOriginalData(){return this.dataManager.originalData}getOptions(){return this.options}async setOptions(t){this.options={...this.options,...t},t.pagination&&this.paginationManager&&(this.paginationManager.options={...this.paginationManager.options,...t.pagination}),t.selection&&this.selectionManager&&(this.selectionManager.options={...this.selectionManager.options,...t.selection},void 0!==t.selection.enabled&&(t.selection.enabled?this.selectionManager.enable():this.selectionManager.disable()),t.selection.mode&&this.selectionManager.setMode(t.selection.mode)),await this.refreshTable()}getSelectedData(){return this.selectionManager?this.selectionManager.getSelectedData():[]}getSelectedIds(){return this.selectionManager?this.selectionManager.getSelectedIds():[]}selectRows(t){this.selectionManager&&this.selectionManager.selectRows(t)}deselectRows(t){this.selectionManager&&this.selectionManager.deselectRows(t)}clearSelection(){this.selectionManager&&this.selectionManager.clearSelection()}isRowSelected(t){return!!this.selectionManager&&this.selectionManager.isRowSelected(t)}getSelectionCount(){return this.selectionManager?this.selectionManager.getSelectionCount():0}enableSelection(){this.selectionManager&&this.selectionManager.enable()}disableSelection(){this.selectionManager&&this.selectionManager.disable()}setSelectionMode(t){this.selectionManager&&this.selectionManager.setMode(t)}selectAllRows(){if(!this.selectionManager)return console.warn("TablixJS: Selection is not enabled. Set selection.enabled to true in options."),0;const t=this.getData();if(0===t.length)return console.warn("TablixJS: No rows available to select."),0;const e=this.options.selection.dataIdKey||"id",a=t.map(t=>t[e]+"");return this.selectionManager.selectRows(a),this.eventManager.trigger("selectAll",{selectedIds:a,selectedData:t,count:t.length}),t.length}destroy(){this.virtualScrollManager&&this.virtualScrollManager.destroy(),this.selectionManager&&this.selectionManager.destroy&&this.selectionManager.destroy(),this.searchManager&&this.searchManager.destroy&&this.searchManager.destroy(),this.filterManager&&this.filterManager.destroy&&this.filterManager.destroy(),this.sortingManager&&this.sortingManager.destroy&&this.sortingManager.destroy(),this.paginationManager&&this.paginationManager.destroy&&this.paginationManager.destroy(),this.container&&(this.container.innerHTML=""),this.virtualScrollManager=null,this.selectionManager=null,this.searchManager=null,this.filterManager=null,this.sortingManager=null,this.paginationManager=null,this.dataManager=null,this.renderer=null,this.eventManager=null}destroy(){const t=this.container.querySelector(".tablix-pagination");t&&t.removeEventListener("click",this._paginationClickHandler),this.selectionManager&&this.selectionManager.destroy(),this.container.innerHTML="",this.dataManager=null,this.renderer=null,this.eventManager=null,this.paginationManager=null,this.sortingManager=null,this.selectionManager=null}}t.Table=g,t.default=g,t.version="0.1.0",Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=tablixjs.umd.min.js.map
