!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).TablixJS=t()}(this,function(){"use strict";class e{constructor(e,t=[]){this.table=e,this.originalData=t,this.filteredData=[...t],this.currentFilters={},this.currentSorts=[],this.serverTotalRows=null}getData(){return this.filteredData}setData(e){this.originalData=e,this.filteredData=[...e],this.table.paginationManager&&this.table.paginationManager.updatePaginationInfo()}setServerData(e,t=null){this.originalData=e,this.filteredData=[...e],this.serverTotalRows=t,this.table.paginationManager&&this.table.paginationManager.updatePaginationInfo(t)}getTotalRows(){return null!==this.serverTotalRows?this.serverTotalRows:this.originalData.length}applyFilter(e){this.currentFilters=e,this.filteredData=0===Object.keys(e).length?[...this.originalData]:this.originalData.filter(t=>Object.entries(e).every(([e,a])=>(t[e]+"").toLowerCase().includes((a+"").toLowerCase()))),this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}setFilteredData(e){this.filteredData=e,this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}applySorting(e){this.currentSorts=e,e&&0!==e.length&&(this.table.sortingManager&&this.table.sortingManager.currentSorts.length>0?this.table.sortingManager._applySorting():this.filteredData.sort((t,a)=>{for(const i of e){const{column:e,direction:r}=i,n=t[e],s=a[e];let l=0;if(s>n?l=-1:n>s&&(l=1),0!==l)return"desc"===r?-l:l}return 0}),this.table.paginationManager&&this.table.paginationManager.resetToFirstPage())}clearFilters(){this.currentFilters={},this.filteredData=[...this.originalData],this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}clearSorting(){this.currentSorts=[],this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}getPageData(e=1){const t=this.table.paginationManager?this.table.paginationManager.pageSize:10,a=(e-1)*t;return this.filteredData.slice(a,a+t)}}class t{constructor(e){this.table=e}renderTable(e,t=!1){const a=this.table.columnManager?this.table.columnManager.getColumns():this.table.options.columns||[],i=this.table.options.controls,r=this.table.virtualScrollManager&&this.table.virtualScrollManager.isEnabled();let n="",s=!1,l=0;const o=this.table.container.querySelector(".tablix-search-input");o&&(n=o.value,s=document.activeElement===o,l=o.selectionStart||0);let c=`<div class="tablix-wrapper" ${this.table.selectionManager&&this.table.selectionManager.options.enabled?`data-selection-enabled data-selection-mode="${this.table.selectionManager.options.mode}"`:"data-selection-disabled"}>`;if(!i.enabled||"top"!==i.position&&"both"!==i.position||(c+=this.renderControls("top")),r){c+=`<div class="tablix-scroll-container" style="height: ${this.table.options.virtualScroll.containerHeight||400}px; overflow: auto; position: relative; border: 1px solid #ddd;">`}if(c+='<table class="tablix-table" style="width:100%; border-collapse:collapse;">',c+='<thead class="tablix-thead"><tr class="tablix-header-row">',a.forEach(e=>{const t=this._isColumnSortable(e),a=this._getSortDirection(e.name);c+=`<th class="tablix-th${t?" tablix-sortable":""}${a?" tablix-sorted tablix-sorted-"+a:""}" data-column="${e.name}">`,c+='<div class="tablix-th-content">',c+=`<span class="tablix-th-text">${e.title||e.name}</span>`,t&&(c+='<span class="tablix-sort-indicator">',c+="asc"===a?`<span class="tablix-sort-arrow tablix-sort-asc" aria-label="${this.table.t("sort.sortedAscending")}">↑</span>`:"desc"===a?`<span class="tablix-sort-arrow tablix-sort-desc" aria-label="${this.table.t("sort.sortedDescending")}">↓</span>`:`<span class="tablix-sort-arrow tablix-sort-none" aria-label="${this.table.t("sort.notSorted")}">↕</span>`,c+="</span>"),c+="</div>",c+="</th>"}),c+="</tr></thead>",c+='<tbody class="tablix-tbody">',r&&t?c+=`<tr class="tablix-placeholder-row" style="display: none;"><td colspan="${a.length}"></td></tr>`:0===e.length?c+=`<tr class="tablix-empty-row"><td colspan="${a.length}" class="tablix-empty-cell">${this.table.t("general.noData")}</td></tr>`:e.forEach((e,t)=>{let i=t;if(this.table.paginationManager&&"client"===this.table.paginationManager.options.mode){i=(this.table.paginationManager.currentPage-1)*this.table.paginationManager.pageSize+t}c+=`<tr class="tablix-row" data-row-index="${i}">`,a.forEach(t=>{const a=e[t.name];let i;if(this.table.columnManager){const r=this.table.columnManager.formatCellValue(t.name,a,e);i=r.isHtml?r.value:this.escapeHtml(r.value)}else i=t.renderer?t.renderer(a,e):this.escapeHtml(a);c+=`<td class="tablix-td">${i}</td>`}),c+="</tr>"}),c+="</tbody>",c+="</table>",r&&(c+="</div>"),c+='<div class="tablix-pagination-container"></div>',!i.enabled||"bottom"!==i.position&&"both"!==i.position||(c+=this.renderControls("bottom")),c+="</div>",this.table.container.innerHTML=c,n){const e=this.table.container.querySelector(".tablix-search-input");e&&(e.value=n)}if(this.renderPagination(),i.enabled&&this.bindControlEvents(),this.table.searchManager&&this.table.searchManager.bindEvents(),this.table.sortingManager&&this.bindSortEvents(),this.table.selectionManager&&this.table.selectionManager.options.enabled&&this.bindRowClickEvents(),this.table.filterUI&&this.table.filterUI.renderFilterIcons(),s){const e=this.table.container.querySelector(".tablix-search-input");e&&requestAnimationFrame(()=>{e.focus(),l>0&&e.setSelectionRange(l,l)})}this.table.eventManager.trigger("afterRender")}renderPagination(){const e=this.table.container.querySelector(".tablix-pagination-container");if(!e||!this.table.paginationManager)return;const t=this.table.paginationManager,a=t.getInfo();if(!t.options.enabled&&void 0!==t.options.enabled)return void(e.innerHTML="");if(1>=a.totalPages&&!t.options.showPageSizes)return void(e.innerHTML="");let i='<div class="tablix-pagination">';if(i+='<div class="tablix-pagination-info">',i+=0===a.totalRows?this.table.t("pagination.noRecords"):this.table.t("pagination.showingRecords",{startRow:a.startRow,endRow:a.endRow,totalRows:a.totalRows}),i+="</div>",t.options.showPageSizes&&t.options.pageSizeOptions.length>1&&(i+='<div class="tablix-pagination-page-size">',i+=this.table.t("general.show")+" ",i+='<select class="tablix-page-size-select">',t.options.pageSizeOptions.forEach(e=>{i+=`<option value="${e}"${e===a.pageSize?" selected":""}>${e}</option>`}),i+="</select>",i+=" "+this.table.t("general.records")+" "+this.table.t("general.perPage"),i+="</div>"),a.totalPages>1){if(i+='<div class="tablix-pagination-nav">',t.options.showFirstLast){i+=`<button class="tablix-pagination-btn tablix-pagination-first" data-page="1"${1===a.currentPage?" disabled":""}>${this.table.t("pagination.first")}</button>`}if(t.options.showPrevNext){i+=`<button class="tablix-pagination-btn tablix-pagination-prev" data-page="${a.currentPage-1}"${a.hasPrevPage?"":" disabled"}>${this.table.t("pagination.previous")}</button>`}if(t.options.showPageNumbers){t.getPageNumbers().forEach(e=>{if("..."===e)i+='<span class="tablix-pagination-ellipsis">...</span>';else{i+=`<button class="tablix-pagination-btn tablix-pagination-page${e===a.currentPage?" active":""}" data-page="${e}">${e}</button>`}})}if(t.options.showPrevNext){i+=`<button class="tablix-pagination-btn tablix-pagination-next" data-page="${a.currentPage+1}"${a.hasNextPage?"":" disabled"}>${this.table.t("pagination.next")}</button>`}if(t.options.showFirstLast){i+=`<button class="tablix-pagination-btn tablix-pagination-last" data-page="${a.totalPages}"${a.currentPage===a.totalPages?" disabled":""}>${this.table.t("pagination.last")}</button>`}i+="</div>"}a.isLoading&&(i+=`<div class="tablix-pagination-loading">${this.table.t("general.loading")}</div>`),i+="</div>",e.innerHTML=i,this.bindPaginationEvents()}bindPaginationEvents(){const e=this.table.container.querySelector(".tablix-pagination");if(!e)return;e.addEventListener("click",async e=>{if(e.target.classList.contains("tablix-pagination-btn")&&!e.target.disabled){e.preventDefault();const t=parseInt(e.target.dataset.page);if(!isNaN(t))try{await this.table.paginationManager.goToPage(t)}catch(e){console.error("Failed to navigate to page:",e)}}});const t=e.querySelector(".tablix-page-size-select");t&&t.addEventListener("change",async e=>{try{const t=parseInt(e.target.value);await this.table.paginationManager.changePageSize(t)}catch(e){console.error("Failed to change page size:",e)}})}escapeHtml(e){if(null==e)return"";const t=document.createElement("div");return t.textContent=""+e,t.innerHTML}renderLoading(){this.table.container.innerHTML=`<div class="tablix-loading">${this.table.t("general.loading")}</div>`}renderError(e){this.table.container.innerHTML=`<div class="tablix-error">${this.table.t("general.error")}: ${this.escapeHtml(e.message||e)}</div>`}renderControls(e){const t=this.table.options.controls,a=this.table.options.search||{enabled:!1,placeholder:null};let i=`<div class="tablix-controls tablix-controls-${e}">`;if(i+='<div class="tablix-controls-left">',t.pagination&&this.table.paginationManager&&(i+='<div class="tablix-control-group tablix-pagination-controls">',i+=`<button type="button" class="tablix-btn tablix-control-btn" data-action="firstPage">${this.table.t("pagination.first")}</button>`,i+=`<button type="button" class="tablix-btn tablix-control-btn" data-action="prevPage">${this.table.t("pagination.previous")}</button>`,i+=`<button type="button" class="tablix-btn tablix-control-btn" data-action="nextPage">${this.table.t("pagination.next")}</button>`,i+=`<button type="button" class="tablix-btn tablix-control-btn" data-action="lastPage">${this.table.t("pagination.last")}</button>`,i+="</div>"),t.pageSize&&this.table.paginationManager){const e=this.table.paginationManager.options.pageSizeOptions,t=this.table.paginationManager.pageSize;i+='<div class="tablix-control-group tablix-page-size-group">',i+=`<label for="tablix-page-size-select">${this.table.t("general.show")}:</label>`,i+='<select class="tablix-page-size-select" id="tablix-page-size-select">',e.forEach(e=>{i+=`<option value="${e}"${e===t?" selected":""}>${e}</option>`}),i+="</select>",i+=`<span>${this.table.t("general.entries")}</span>`,i+="</div>"}if(t.refresh&&(i+='<div class="tablix-control-group tablix-refresh-group">',i+=`<button type="button" class="tablix-btn tablix-control-btn" data-action="refresh" title="${this.table.t("controls.refresh")}">⟳</button>`,i+="</div>"),i+="</div>",i+='<div class="tablix-controls-right">',t.search&&a.enabled){const e=a.placeholder||this.table.t("search.placeholder");i+='<div class="tablix-control-group tablix-search-group">',i+=`<input type="text" \n                      class="tablix-search-input" \n                      id="tablix-search-input" \n                      name="table-search"\n                      placeholder="${e}" />`,i+=`<button type="button" class="tablix-btn tablix-search-clear" title="${this.table.t("search.clear")}" style="display: none;">✕</button>`,i+="</div>"}return i+="</div>",i+="</div>",i}bindControlEvents(){const e=this.table.container.querySelector(".tablix-wrapper");if(!e)return;const t=e.querySelector(".tablix-page-size-select");t&&t.addEventListener("change",async e=>{try{const t=parseInt(e.target.value);await this.table.changePageSize(t)}catch(e){console.error("Failed to change page size:",e)}}),e.addEventListener("click",async e=>{if(e.target.classList.contains("tablix-control-btn")){e.preventDefault();const t=e.target.dataset.action;try{switch(t){case"firstPage":await this.table.firstPage();break;case"prevPage":await this.table.prevPage();break;case"nextPage":await this.table.nextPage();break;case"lastPage":await this.table.lastPage();break;case"refresh":await this.handleRefresh();break;case"export":this.handleExport()}}catch(e){console.error(`Failed to execute action ${t}:`,e)}}})}async handleRefresh(){if(this.table.eventManager.trigger("beforeRefresh"),this.table.options.onRefresh&&"function"==typeof this.table.options.onRefresh)try{const e=await this.table.options.onRefresh();e&&await this.table.loadData(e)}catch(e){console.error("Custom refresh failed:",e)}else this.table.paginationManager&&"server"===this.table.paginationManager.options.mode?await this.table.paginationManager.refreshTable():await this.table.refreshTable();this.table.eventManager.trigger("afterRefresh")}handleExport(){const e=this.table.getData(),t=this.table.options.columns||[];let a=t.map(e=>e.title||e.name).join(",")+"\n";e.forEach(e=>{const i=t.map(t=>{const a=e[t.name];return"string"==typeof a&&a.includes(",")?`"${a.replace(/"/g,'""')}"`:a});a+=i.join(",")+"\n"});const i=new Blob([a],{type:"text/csv"}),r=URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download="table-data.csv",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),this.table.eventManager.trigger("afterExport",{data:e,format:"csv"})}bindSortEvents(){const e=this.table.container.querySelector(".tablix-header-row");e&&(e.addEventListener("click",async e=>{const t=e.target.closest(".tablix-sortable");if(!t)return;e.preventDefault();const a=t.dataset.column;try{await this.table.toggleSort(a)}catch(e){console.error("Failed to sort column:",e)}}),e.addEventListener("keydown",async e=>{const t=e.target.closest(".tablix-sortable");if(!t||"Enter"!==e.key&&" "!==e.key)return;e.preventDefault();const a=t.dataset.column;try{await this.table.toggleSort(a)}catch(e){console.error("Failed to sort column:",e)}}))}bindRowClickEvents(){const e=this.table.container.querySelector(".tablix-tbody");e&&e.addEventListener("click",e=>{const t=e.target.closest(".tablix-row");if(!t||t.classList.contains("tablix-empty-row"))return;const a=parseInt(t.dataset.rowIndex,10);if(isNaN(a))return;let i=a;if(this.table.paginationManager&&"client"===this.table.paginationManager.options.mode){i=a-(this.table.paginationManager.currentPage-1)*this.table.paginationManager.pageSize}const r=this.getCurrentPageData();if(i>=0&&r.length>i){this.table.eventManager.trigger("rowClick",{rowData:r[i],rowIndex:a,localRowIndex:i,originalEvent:e})}})}getCurrentPageData(){return this.table.paginationManager?this.table.paginationManager.getCurrentPageData()||[]:this.table.dataManager.getData()}updateSortIndicators(e){this.table.container.querySelectorAll(".tablix-th[data-column]").forEach(t=>{const a=e&&e.column===t.dataset.column;t.classList.remove("tablix-sorted","tablix-sorted-asc","tablix-sorted-desc");const i=t.querySelector(".tablix-sort-indicator");if(!i)return;const r=i.querySelector(".tablix-sort-arrow");r&&(a?(t.classList.add("tablix-sorted","tablix-sorted-"+e.direction),r.classList.remove("tablix-sort-none","tablix-sort-asc","tablix-sort-desc"),r.classList.add("tablix-sort-"+e.direction),r.textContent="asc"===e.direction?"↑":"↓",r.setAttribute("aria-label",`${this.table.t("sort.sorted")}${this.table.t("asc"===e.direction?"sort.sortedAscending":"sort.sortedDescending")}`),r.removeAttribute("data-sort-order")):(r.classList.remove("tablix-sort-asc","tablix-sort-desc"),r.classList.add("tablix-sort-none"),r.textContent="↕",r.setAttribute("aria-label",this.table.t("sort.notSorted")),r.removeAttribute("data-sort-order")))})}_isColumnSortable(e){return!!this.table.sortingManager&&this.table.sortingManager.isColumnSortable(e.name)}_getSortDirection(e){return this.table.sortingManager?this.table.sortingManager.getSortDirection(e):null}}class a{constructor(){this.events={}}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){if(this.events[e]){const a=this.events[e].indexOf(t);a>-1&&this.events[e].splice(a,1)}}clear(e){e?this.events[e]=[]:this.events={}}trigger(e,t){(this.events[e]||[]).forEach(e=>e(t))}}class i{constructor(e,t={}){this.table=e,this.options={pageSize:10,mode:"client",showPageNumbers:!0,maxPageNumbers:5,showFirstLast:!0,showPrevNext:!0,showPageSizes:!1,pageSizeOptions:[10,25,50,100],serverDataLoader:null,...t},this.currentPage=1,this.totalPages=1,this.totalRows=0,this.pageSize=this.options.pageSize,this.isLoading=!1,this.init()}init(){this.updatePaginationInfo()}updatePaginationInfo(e=null){this.totalRows="client"===this.options.mode?this.table.dataManager.filteredData.length:e||this.totalRows,this.totalPages=Math.ceil(this.totalRows/this.pageSize)||1,this.currentPage>this.totalPages&&(this.currentPage=this.totalPages),1>this.currentPage&&(this.currentPage=1)}async getPageData(){return"client"===this.options.mode?this.getClientPageData():await this.getServerPageData()}getClientPageData(){const e=(this.currentPage-1)*this.pageSize;return this.table.dataManager.filteredData.slice(e,e+this.pageSize)}getCurrentPageData(){return"client"===this.options.mode?this.getClientPageData():this.table.dataManager.getData()}async getServerPageData(){if(!this.options.serverDataLoader)throw Error("Server data loader not configured for server-side pagination");this.isLoading=!0,this.table.eventManager.trigger("beforePageLoad",{page:this.currentPage,pageSize:this.pageSize});try{const e=await this.options.serverDataLoader({page:this.currentPage,pageSize:this.pageSize,filters:this.table.dataManager.currentFilters||{},sorts:this.table.dataManager.currentSorts||[]});return void 0!==e.totalRows&&this.updatePaginationInfo(e.totalRows),this.isLoading=!1,this.table.eventManager.trigger("afterPageLoad",{page:this.currentPage,pageSize:this.pageSize,data:e.data,totalRows:e.totalRows}),e.data}catch(e){throw this.isLoading=!1,this.table.eventManager.trigger("pageLoadError",e),e}}async goToPage(e){const t=Math.max(1,Math.min(e,this.totalPages));if(t===this.currentPage)return;const a=this.currentPage;this.currentPage=t,this.table.eventManager.trigger("beforePageChange",{oldPage:a,newPage:this.currentPage,pageSize:this.pageSize});try{await this.refreshTable(),this.table.eventManager.trigger("afterPageChange",{oldPage:a,newPage:this.currentPage,pageSize:this.pageSize})}catch(e){throw this.currentPage=a,e}}async nextPage(){this.totalPages>this.currentPage&&await this.goToPage(this.currentPage+1)}async prevPage(){this.currentPage>1&&await this.goToPage(this.currentPage-1)}async firstPage(){await this.goToPage(1)}async lastPage(){await this.goToPage(this.totalPages)}async changePageSize(e){if(e===this.pageSize)return;const t=this.pageSize;this.pageSize=e;const a=Math.floor((this.currentPage-1)*t/e)+1;this.updatePaginationInfo(),this.table.eventManager.trigger("beforePageSizeChange",{oldPageSize:t,newPageSize:this.pageSize,oldPage:this.currentPage,newPage:a}),this.currentPage=a,await this.refreshTable(),this.table.eventManager.trigger("afterPageSizeChange",{oldPageSize:t,newPageSize:this.pageSize,page:this.currentPage})}async refreshTable(){const e=await this.getPageData();this.table.renderer.renderTable(e),this.table.renderer.renderPagination()}async resetToFirstPage(){this.currentPage=1,this.updatePaginationInfo(),await this.refreshTable()}getInfo(){return{currentPage:this.currentPage,totalPages:this.totalPages,pageSize:this.pageSize,totalRows:this.totalRows,startRow:0===this.totalRows?0:(this.currentPage-1)*this.pageSize+1,endRow:Math.min(this.currentPage*this.pageSize,this.totalRows),hasNextPage:this.totalPages>this.currentPage,hasPrevPage:this.currentPage>1,isLoading:this.isLoading}}getPageNumbers(){const e=this.options.maxPageNumbers,t=[];if(e<this.totalPages){let a=Math.max(1,this.currentPage-Math.floor(e/2)),i=Math.min(this.totalPages,a+e-1);e>i-a+1&&(a=Math.max(1,i-e+1));for(let e=a;i>=e;e++)t.push(e);a>1&&(a>2&&t.unshift("..."),t.unshift(1)),this.totalPages>i&&(this.totalPages-1>i&&t.push("..."),t.push(this.totalPages))}else for(let e=1;this.totalPages>=e;e++)t.push(e);return t}setEnabled(e){this.options.enabled=e,this.table.renderer.renderPagination()}async setMode(e,t=null){e!==this.options.mode&&(this.options.mode=e,"server"===e&&t&&(this.options.serverDataLoader=t),this.currentPage=1,this.updatePaginationInfo(),await this.refreshTable())}}class r{constructor(e,t={}){this.table=e,this.options={enabled:!0,mode:"client",serverSortLoader:null,defaultSortType:"auto",caseSensitive:!1,nullsFirst:!1,...t},this.currentSort=null,this.sortOrder=["asc","desc",null],this.sortTypes={auto:this._autoSort.bind(this),string:this._stringSort.bind(this),number:this._numberSort.bind(this),date:this._dateSort.bind(this),boolean:this._booleanSort.bind(this)}}async sort(e,t="asc"){this.table.eventManager.trigger("beforeSort",{columnName:e,direction:t,currentSort:this.currentSort}),"server"===this.options.mode?await this._sortServer(e,t):this._sortClient(e,t),this.table.renderer.updateSortIndicators(this.currentSort),await this.table.refreshTable(),this.table.eventManager.trigger("afterSort",{columnName:e,direction:t,currentSort:this.currentSort})}async toggleSort(e){const t=this.sortOrder.indexOf(this.currentSort&&this.currentSort.column===e?this.currentSort.direction:null),a=this.sortOrder[(t+1)%this.sortOrder.length];await this.sort(e,a)}_sortClient(e,t){this.currentSort=null!==t?{column:e,direction:t}:null,this._applySorting()}async _sortServer(e,t){if(this.options.serverSortLoader){this.currentSort=null!==t?{column:e,direction:t}:null;try{const e=await this.options.serverSortLoader({sort:this.currentSort,filters:this.table.dataManager.currentFilters,page:this.table.paginationManager?this.table.paginationManager.currentPage:1,pageSize:this.table.paginationManager?this.table.paginationManager.pageSize:10});this.table.dataManager.setServerData(e.data,e.totalRows)}catch(e){throw console.error("Failed to load sorted data from server:",e),e}}else console.warn("Server-side sorting enabled but no serverSortLoader provided")}_applySorting(){if(!this.currentSort)return;const e=this.table.options.columns||[];this.table.dataManager.filteredData.sort((t,a)=>{const i=e.find(e=>e.name===this.currentSort.column||e.key===this.currentSort.column),r=this._compareValues(t[this.currentSort.column],a[this.currentSort.column],i);return"desc"===this.currentSort.direction?-r:r}),this.table.paginationManager&&this.table.paginationManager.resetToFirstPage()}_compareValues(e,t,a){if(null==e&&null==t)return 0;if(null==e)return this.options.nullsFirst?-1:1;if(null==t)return this.options.nullsFirst?1:-1;if(a&&a.sortFunction)return a.sortFunction(e,t);const i=a&&a.sortType||this.options.defaultSortType;return this.sortTypes[i]?this.sortTypes[i](e,t):this._autoSort(e,t)}_autoSort(e,t){const a=parseFloat(e),i=parseFloat(t);if(!isNaN(a)&&!isNaN(i))return a-i;const r=new Date(e),n=new Date(t),s=e=>/^\d{4}-\d{2}-\d{2}/.test(e)||/^\d{1,2}\/\d{1,2}\/\d{4}/.test(e)||/^\d{1,2}-\d{1,2}-\d{4}/.test(e);return""+r!="Invalid Date"&&""+n!="Invalid Date"&&s(e+"")&&s(t+"")?r-n:this._stringSort(e,t)}_stringSort(e,t){const a=(e+"").trim(),i=(t+"").trim();return this.options.caseSensitive?a.localeCompare(i):a.localeCompare(i,void 0,{sensitivity:"base"})}_numberSort(e,t){const a=parseFloat(e),i=parseFloat(t);return isNaN(a)&&isNaN(i)?0:isNaN(a)?1:isNaN(i)?-1:a-i}_dateSort(e,t){const a=new Date(e),i=new Date(t);return""+a=="Invalid Date"&&""+i=="Invalid Date"?0:""+a=="Invalid Date"?1:""+i=="Invalid Date"?-1:a-i}_booleanSort(e,t){const a=!!e;return a===!!t?0:a?1:-1}async clearSorting(){if(this.currentSort=null,"server"===this.options.mode&&this.options.serverSortLoader)try{const e=await this.options.serverSortLoader({sort:null,filters:this.table.dataManager.currentFilters,page:this.table.paginationManager?this.table.paginationManager.currentPage:1,pageSize:this.table.paginationManager?this.table.paginationManager.pageSize:10});this.table.dataManager.setServerData(e.data,e.totalRows)}catch(e){console.error("Failed to clear server sorting:",e)}this.table.renderer.updateSortIndicators(null),await this.table.refreshTable(),this.table.eventManager.trigger("afterSort",{currentSort:null})}getSortState(){return{sort:this.currentSort,mode:this.options.mode}}setOptions(e){this.options={...this.options,...e}}isColumnSortable(e){if(!this.options.enabled)return!1;const t=(this.table.options.columns||[]).find(t=>t.name===e);return t&&!1!==t.sortable}getSortDirection(e){return this.currentSort&&this.currentSort.column===e?this.currentSort.direction:null}}class n{constructor(e){this.table=e,this.columns=[],this.formatters=new Map,this.supportedFormats=["text","date","currency","number","percent"]}initializeColumns(e=[]){return this.columns=e.map(e=>this.prepareColumn(e)),this.compileFormatters(),this.columns}prepareColumn(e){const t={...e};if(t.format&&!this.supportedFormats.includes(t.format)&&(console.warn(`TablixJS: Unsupported format type '${t.format}' for column '${t.name}'. Falling back to no formatting.`),delete t.format),!t.name)throw Error('TablixJS: Column must have a "name" property');return t.title||(t.title=t.name),t}compileFormatters(){this.formatters.clear(),this.columns.forEach(e=>{if(e.format){const t=this.createFormatter(e);t&&this.formatters.set(e.name,t)}})}createFormatter(e){const{format:t,locale:a,formatOptions:i={}}=e;switch(t){case"text":return e=>this.formatText(e);case"date":return e=>this.formatDate(e,a,i);case"currency":return t=>this.formatCurrency(t,a,i,e.currency);case"number":return e=>this.formatNumber(e,a,i);case"percent":return e=>this.formatPercent(e,a,i);default:return null}}formatCellValue(e,t,a){const i=this.getColumn(e);if(i&&i.renderer){const r=this.formatters.get(e),n=r?r(t):t;return{value:i.renderer(t,a,n),isHtml:!0}}const r=this.formatters.get(e);return r?{value:r(t),isHtml:!1}:{value:t,isHtml:!1}}getColumn(e){return this.columns.find(t=>t.name===e)||null}getColumns(){return this.columns}formatText(e){return null==e?"":e+""}formatDate(e,t,a={}){if(null==e)return"";try{const i=e instanceof Date?e:new Date(e);if(isNaN(i.getTime()))return e+"";return new Intl.DateTimeFormat(t,a).format(i)}catch(t){return console.warn("TablixJS: Date formatting error:",t),e+""}}formatCurrency(e,t,a={},i="USD"){if(null==e)return"";const r=Number(e);if(isNaN(r))return e+"";try{const e={style:"currency",currency:i,...a};return new Intl.NumberFormat(t,e).format(r)}catch(t){return console.warn("TablixJS: Currency formatting error:",t),e+""}}formatNumber(e,t,a={}){if(null==e)return"";const i=Number(e);if(isNaN(i))return e+"";try{return new Intl.NumberFormat(t,a).format(i)}catch(t){return console.warn("TablixJS: Number formatting error:",t),e+""}}formatPercent(e,t,a={}){if(null==e)return"";const i=Number(e);if(isNaN(i))return e+"";try{const e={style:"percent",...a};return new Intl.NumberFormat(t,e).format(i)}catch(t){return console.warn("TablixJS: Percent formatting error:",t),e+""}}registerFormat(e,t){this.supportedFormats.includes(e)&&console.warn(`TablixJS: Format type '${e}' already exists and will be overridden.`),this.supportedFormats.push(e),console.log(`TablixJS: Custom format '${e}' registered.`)}getSupportedFormats(){return[...this.supportedFormats]}}class s{constructor(e,t={}){this.table=e,this.options={enabled:!0,mode:"client",serverFilterLoader:null,debounceDelay:300,showBadges:!0,showTooltips:!0,...t},this.columnFilters=new Map,this.operators={none:{label:"None",apply:()=>!0},isEmpty:{label:"Is empty",apply:e=>null==e||""===e},isNotEmpty:{label:"Is not empty",apply:e=>null!=e&&""!==e},equals:{label:"Is equal to",apply:(e,t)=>(e+"").toLowerCase()===(t+"").toLowerCase()},notEquals:{label:"Is not equal to",apply:(e,t)=>(e+"").toLowerCase()!==(t+"").toLowerCase()},beginsWith:{label:"Begins with",apply:(e,t)=>(e+"").toLowerCase().startsWith((t+"").toLowerCase())},endsWith:{label:"Ends with",apply:(e,t)=>(e+"").toLowerCase().endsWith((t+"").toLowerCase())},contains:{label:"Contains",apply:(e,t)=>(e+"").toLowerCase().includes((t+"").toLowerCase())},notContains:{label:"Does not contain",apply:(e,t)=>!(e+"").toLowerCase().includes((t+"").toLowerCase())}},this.debounceTimer=null,this.openDropdowns=new Set}async applyFilter(e,t){if(!this.validateFilterConfig(t))return void console.warn(`TablixJS: Invalid filter config for column '${e}'`);const a={columnName:e,filterConfig:t,currentFilters:this.getActiveFilters()};this.table.eventManager.trigger("beforeFilter",a),this.columnFilters.set(e,{type:t.type,config:t,isActive:this.isFilterActive(t)}),"server"===this.options.mode?await this._filterServer():this._filterClient(),this.updateFilterIndicators(),await this.table.refreshTable(),this.table.eventManager.trigger("afterFilter",{columnName:e,filterConfig:t,filteredData:this.table.dataManager.getData(),activeFilters:this.getActiveFilters()})}async clearFilter(e){if(!this.columnFilters.has(e))return;const t={columnName:e,filterConfig:null,currentFilters:this.getActiveFilters()};this.table.eventManager.trigger("beforeFilter",t),this.columnFilters.delete(e),"server"===this.options.mode?await this._filterServer():this._filterClient(),this.updateFilterIndicators(),await this.table.refreshTable(),this.table.eventManager.trigger("afterFilter",{columnName:e,filterConfig:null,filteredData:this.table.dataManager.getData(),activeFilters:this.getActiveFilters()})}async clearAllFilters(){if(0===this.columnFilters.size)return;const e={columnName:null,filterConfig:null,currentFilters:this.getActiveFilters()};this.table.eventManager.trigger("beforeFilter",e),this.columnFilters.clear(),"server"===this.options.mode?await this._filterServer():this._filterClient(),this.updateFilterIndicators(),await this.table.refreshTable(),this.table.eventManager.trigger("afterFilter",{columnName:null,filterConfig:null,filteredData:this.table.dataManager.getData(),activeFilters:this.getActiveFilters()})}getActiveFilters(){const e={};for(const[t,a]of this.columnFilters)a.isActive&&(e[t]=a.config);return e}getColumnUniqueValues(e){const t=this.table.dataManager.originalData,a=new Set;return t.forEach(t=>{const i=t[e];null!=i&&a.add(i+"")}),Array.from(a).sort()}getColumnFilter(e){return this.columnFilters.get(e)||null}hasColumnFilter(e){const t=this.columnFilters.get(e);return t&&t.isActive}validateFilterConfig(e){return!(!e||!e.type)&&("value"===e.type?Array.isArray(e.values):"condition"===e.type&&(Array.isArray(e.conditions)&&e.conditions.every(e=>e.operator&&this.operators[e.operator])))}isFilterActive(e){return!!e&&("value"===e.type?e.values&&e.values.length>0:"condition"===e.type&&(e.conditions&&e.conditions.some(e=>e.operator&&"none"!==e.operator&&("isEmpty"===e.operator||"isNotEmpty"===e.operator||void 0!==e.value))))}_filterClient(){const e=this.table.dataManager.originalData,t=this.getActiveFilters();let a;a=0===Object.keys(t).length?[...e]:e.filter(e=>Object.entries(t).every(([t,a])=>this._testRowAgainstFilter(e,t,a))),this.table.dataManager.setFilteredData(a)}async _filterServer(){if(this.options.serverFilterLoader)try{const e=await this.options.serverFilterLoader({filters:this.getActiveFilters(),sort:this.table.sortingManager?this.table.sortingManager.currentSort:null,page:this.table.paginationManager?this.table.paginationManager.currentPage:1,pageSize:this.table.paginationManager?this.table.paginationManager.pageSize:10});this.table.dataManager.setServerData(e.data,e.totalRows)}catch(e){throw console.error("Failed to load filtered data from server:",e),e}else console.warn("TablixJS: Server-side filtering enabled but no serverFilterLoader provided")}_testRowAgainstFilter(e,t,a){const i=e[t];return"value"===a.type?a.values.includes(i+""):"condition"!==a.type||a.conditions.every(e=>{const t=this.operators[e.operator];return!t||t.apply(i,e.value)})}updateFilterIndicators(){this.table.container.querySelectorAll(".tablix-th").forEach(e=>{const t=e.dataset.column,a=this.hasColumnFilter(t),i=e.querySelector(".tablix-filter-indicator");if(a)e.classList.add("tablix-filtered"),i&&(i.classList.add("tablix-filter-active"),this.options.showBadges&&this._updateFilterBadge(e,t));else if(e.classList.remove("tablix-filtered"),i){i.classList.remove("tablix-filter-active");const e=i.querySelector(".tablix-filter-badge");e&&e.remove()}})}_updateFilterBadge(e,t){const a=e.querySelector(".tablix-filter-indicator");if(!a)return;const i=this.getColumnFilter(t);if(!i||!i.isActive)return;let r="";if("value"===i.type)r=""+i.config.values.length;else if("condition"===i.type){r=""+i.config.conditions.filter(e=>e.operator&&"none"!==e.operator).length}let n=a.querySelector(".tablix-filter-badge");!n&&r&&(n=document.createElement("span"),n.className="tablix-filter-badge",a.appendChild(n)),n&&(n.textContent=r)}registerOperator(e,t){if(!t.label||"function"!=typeof t.apply)throw Error("TablixJS: Custom operator must have label and apply function");this.operators[e]=t}getOperators(){return{...this.operators}}}class l{constructor(e){this.filterManager=e,this.table=e.table,this.activeDropdown=null,this.handleDocumentClick=this.handleDocumentClick.bind(this),this.handleFilterIconClick=this.handleFilterIconClick.bind(this),this.init()}init(){document.addEventListener("click",this.handleDocumentClick)}destroy(){document.removeEventListener("click",this.handleDocumentClick),this.closeAllDropdowns()}renderFilterIcons(){this.table.container.querySelectorAll(".tablix-th").forEach(e=>{const t=e.dataset.column;if(!t)return;const a=e.querySelector(".tablix-th-content");if(!a)return;let i=e.querySelector(".tablix-filter-indicator");if(i){const e=i.querySelector(".tablix-filter-icon");return void(e&&(e.title=this.table.t("filter.filterColumn")))}i=document.createElement("span"),i.className="tablix-filter-indicator",i.innerHTML=`\n        <span class="tablix-filter-icon" title="${this.table.t("filter.filterColumn")}">⚪</span>\n      `,i.addEventListener("click",e=>{e.stopPropagation(),this.handleFilterIconClick(t,i)});const r=a.querySelector(".tablix-sort-indicator");r?a.insertBefore(i,r.nextSibling):a.appendChild(i)})}handleFilterIconClick(e,t){this.closeAllDropdowns();const a=this.createFilterDropdown(e);this.showDropdown(a,t),this.activeDropdown={dropdown:a,columnName:e}}handleDocumentClick(e){if(this.activeDropdown){this.activeDropdown.dropdown.contains(e.target)||this.closeAllDropdowns()}}createFilterDropdown(e){const t=document.createElement("div");return t.className="tablix-filter-dropdown",t.innerHTML=this.renderDropdownContent(e),this.bindDropdownEvents(t,e),t}renderDropdownContent(e){const t=this.filterManager.getColumnFilter(e);return`\n      <div class="tablix-filter-dropdown-header">\n        <h4>${this.table.t("filter.filter")}: ${e}</h4>\n        <button class="tablix-filter-close" type="button">×</button>\n      </div>\n      \n      <div class="tablix-filter-tabs">\n        <button class="tablix-filter-tab ${t&&"value"!==t.type?"":"active"}" \n                data-tab="value">${this.table.t("filter.filterByValue")}</button>\n        <button class="tablix-filter-tab ${t&&"condition"===t.type?"active":""}" \n                data-tab="condition">${this.table.t("filter.filterByCondition")}</button>\n      </div>\n      \n      <div class="tablix-filter-content">\n        <div class="tablix-filter-panel tablix-filter-value-panel ${t&&"value"!==t.type?"":"active"}">\n          ${this.renderValueFilterPanel(e,t)}\n        </div>\n        \n        <div class="tablix-filter-panel tablix-filter-condition-panel ${t&&"condition"===t.type?"active":""}">\n          ${this.renderConditionFilterPanel(e,t)}\n        </div>\n      </div>\n      \n      <div class="tablix-filter-actions">\n        <button class="tablix-filter-apply" type="button">${this.table.t("filter.apply")}</button>\n        <button class="tablix-filter-clear" type="button">${this.table.t("filter.clear")}</button>\n        <button class="tablix-filter-cancel" type="button">${this.table.t("filter.cancel")}</button>\n      </div>\n    `}renderValueFilterPanel(e,t){const a=this.filterManager.getColumnUniqueValues(e),i=t&&"value"===t.type?t.config.values:[];if(0===a.length)return`<p class="tablix-filter-empty">${this.table.t("filter.noValuesAvailable")}</p>`;let r=`\n      <div class="tablix-filter-search">\n        <input type="text" \n               id="tablix-filter-search-${e}" \n               name="filter-search-${e}"\n               placeholder="${this.table.t("filter.searchValues")}" \n               class="tablix-filter-search-input">\n      </div>\n      <div class="tablix-filter-select-all">\n        <label>\n          <input type="checkbox" \n                 id="tablix-filter-select-all-${e}" \n                 name="filter-select-all-${e}"\n                 class="tablix-filter-select-all-checkbox"> ${this.table.t("filter.selectAll")}\n        </label>\n      </div>\n      <div class="tablix-filter-values">\n    `;return a.forEach((t,a)=>{const n=i.includes(t);r+=`\n        <label class="tablix-filter-value-item">\n          <input type="checkbox" \n                 id="${`tablix-filter-value-${e}-${a}`}" \n                 name="filter-value-${e}" \n                 value="${this.escapeHtml(t)}" \n                 ${n?"checked":""}>\n          <span class="tablix-filter-value-text">${this.escapeHtml(t)}</span>\n        </label>\n      `}),r+="</div>",r}renderConditionFilterPanel(e,t){let a='<div class="tablix-filter-conditions">';return(t&&"condition"===t.type?t.config.conditions:[{operator:"none",value:""}]).forEach((e,t)=>{a+=this.renderConditionRow(e,t)}),a+=`\n      </div>\n      <button class="tablix-filter-add-condition" type="button">+ ${this.table.t("filter.addCondition")}</button>\n    `,a}renderConditionRow(e,t){const a=this.filterManager.getOperators(),i=e.operator&&!["none","isEmpty","isNotEmpty"].includes(e.operator);let r=`\n      <div class="tablix-filter-condition" data-index="${t}">\n        <select class="tablix-filter-operator" \n                id="tablix-filter-operator-${t}" \n                name="filter-operator-${t}">\n    `;return Object.entries(a).forEach(([t,a])=>{r+=`<option value="${t}"${e.operator===t?" selected":""}>${a.label}</option>`}),r+=`\n        </select>\n        <input type="text" \n               id="tablix-filter-value-${t}" \n               name="filter-value-${t}"\n               class="tablix-filter-value" \n               placeholder="${this.table.t("filter.value")}" \n               value="${this.escapeHtml(e.value||"")}"\n               ${i?"":"disabled"}>\n        <button class="tablix-filter-remove-condition" \n                type="button" \n                data-index="${t}"\n                title="${this.table.t("filter.removeCondition")}">×</button>\n      </div>\n    `,r}bindDropdownEvents(e,t){e.querySelectorAll(".tablix-filter-tab").forEach(t=>{t.addEventListener("click",t=>{this.switchTab(e,t.target.dataset.tab)})}),e.querySelector(".tablix-filter-close").addEventListener("click",()=>{this.closeAllDropdowns()}),e.querySelector(".tablix-filter-apply").addEventListener("click",()=>{this.applyFilter(e,t)}),e.querySelector(".tablix-filter-clear").addEventListener("click",()=>{this.clearFilter(t)}),e.querySelector(".tablix-filter-cancel").addEventListener("click",()=>{this.closeAllDropdowns()}),this.bindValueFilterEvents(e,t),this.bindConditionFilterEvents(e,t)}bindValueFilterEvents(e,t){const a=e.querySelector(".tablix-filter-value-panel");if(!a)return;const i=a.querySelector(".tablix-filter-search-input");if(i){let e;i.addEventListener("input",t=>{clearTimeout(e),e=setTimeout(()=>{this.filterValueList(a,t.target.value)},this.filterManager.options.debounceDelay||150)})}const r=a.querySelector(".tablix-filter-select-all-checkbox");r&&r.addEventListener("change",e=>{this.toggleSelectAll(a,e.target.checked)}),a.querySelectorAll('.tablix-filter-value-item input[type="checkbox"]').forEach(e=>{e.addEventListener("change",()=>{this.updateSelectAllState(a)})}),this.updateSelectAllState(a)}bindConditionFilterEvents(e,t){const a=e.querySelector(".tablix-filter-condition-panel");if(!a)return;const i=a.querySelector(".tablix-filter-add-condition");i&&i.addEventListener("click",()=>{this.addCondition(a)}),this.bindConditionRowEvents(a)}bindConditionRowEvents(e){e.querySelectorAll(".tablix-filter-operator").forEach(e=>{e.addEventListener("change",e=>{const t=e.target.parentElement.querySelector(".tablix-filter-value"),a=!["none","isEmpty","isNotEmpty"].includes(e.target.value);t.disabled=!a,a||(t.value="")})}),e.querySelectorAll(".tablix-filter-remove-condition").forEach(t=>{t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const a=t.target.closest(".tablix-filter-condition");if(e.querySelector(".tablix-filter-conditions").querySelectorAll(".tablix-filter-condition").length>1)a.remove();else{const e=a.querySelector(".tablix-filter-operator"),t=a.querySelector(".tablix-filter-value");e.value="none",t.value="",t.disabled=!0}})})}switchTab(e,t){e.querySelectorAll(".tablix-filter-tab").forEach(e=>{e.classList.toggle("active",e.dataset.tab===t)}),e.querySelectorAll(".tablix-filter-panel").forEach(e=>{const a=e.classList.contains(`tablix-filter-${t}-panel`);e.classList.toggle("active",a)})}filterValueList(e,t){const a=e.querySelectorAll(".tablix-filter-value-item"),i=t.toLowerCase();a.forEach(e=>{const t=e.querySelector(".tablix-filter-value-text").textContent.toLowerCase().includes(i);e.style.display=t?"":"none"})}toggleSelectAll(e,t){e.querySelectorAll('.tablix-filter-value-item input[type="checkbox"]').forEach(e=>{"none"!==e.closest(".tablix-filter-value-item").style.display&&(e.checked=t)})}updateSelectAllState(e){const t=e.querySelector(".tablix-filter-select-all-checkbox");if(!t)return;const a=e.querySelectorAll('.tablix-filter-value-item input[type="checkbox"]'),i=Array.from(a).filter(e=>"none"!==e.closest(".tablix-filter-value-item").style.display),r=i.filter(e=>e.checked).length;t.checked=r>0&&r===i.length,t.indeterminate=r>0&&i.length>r}addCondition(e){const t=e.querySelector(".tablix-filter-conditions"),a=this.renderConditionRow({operator:"none",value:""},t.children.length);t.insertAdjacentHTML("beforeend",a);const i=t.lastElementChild;i.querySelector(".tablix-filter-operator").addEventListener("change",e=>{const t=e.target.parentElement.querySelector(".tablix-filter-value"),a=!["none","isEmpty","isNotEmpty"].includes(e.target.value);t.disabled=!a,a||(t.value="")});i.querySelector(".tablix-filter-remove-condition").addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();const a=t.target.closest(".tablix-filter-condition");if(e.querySelector(".tablix-filter-conditions").querySelectorAll(".tablix-filter-condition").length>1)a.remove();else{const e=a.querySelector(".tablix-filter-operator"),t=a.querySelector(".tablix-filter-value");e.value="none",t.value="",t.disabled=!0}})}async applyFilter(e,t){let a;a="value"===e.querySelector(".tablix-filter-tab.active").dataset.tab?this.collectValueFilter(e):this.collectConditionFilter(e),await this.filterManager.applyFilter(t,a),this.closeAllDropdowns()}collectValueFilter(e){const t=e.querySelector(".tablix-filter-value-panel").querySelectorAll('.tablix-filter-value-item input[type="checkbox"]:checked');return{type:"value",values:Array.from(t).map(e=>e.value)}}collectConditionFilter(e){const t=e.querySelector(".tablix-filter-condition-panel").querySelectorAll(".tablix-filter-condition");return{type:"condition",conditions:Array.from(t).map(e=>({operator:e.querySelector(".tablix-filter-operator").value,value:e.querySelector(".tablix-filter-value").value})).filter(e=>"none"!==e.operator)}}async clearFilter(e){await this.filterManager.clearFilter(e),this.closeAllDropdowns()}showDropdown(e,t){document.body.appendChild(e),e.style.position="absolute",e.style.top="-9999px",e.style.left="-9999px",e.style.display="block",e.style.visibility="hidden";const a=t.getBoundingClientRect(),i=e.getBoundingClientRect();let r=a.left+window.scrollX,n=a.bottom+window.scrollY+5;r+i.width>window.innerWidth+window.scrollX&&(r=window.innerWidth+window.scrollX-i.width-10),n+i.height>window.innerHeight+window.scrollY&&(n=a.top+window.scrollY-i.height-5),r=Math.max(window.scrollX+10,r),n=Math.max(window.scrollY+10,n),e.style.left=r+"px",e.style.top=n+"px",e.style.visibility="visible"}closeAllDropdowns(){this.activeDropdown&&(this.activeDropdown.dropdown.remove(),this.activeDropdown=null)}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}}class o{constructor(e,t={}){this.table=e,this.options={enabled:!0,placeholder:"Search...",searchDelay:300,caseSensitive:!1,searchColumns:[],minLength:1,...t},this.options.placeholder||(this.options.placeholder="Search..."),this.currentSearchTerm="",this.searchTimeout=null,this.originalData=null,this.handleSearchInput=this.handleSearchInput.bind(this),this.handleSearchClear=this.handleSearchClear.bind(this)}init(){this.originalData=this.table.dataManager.originalData,this.table.eventManager.on("afterLoad",e=>{this.originalData=e.data||e.source,this.currentSearchTerm&&this.performSearch(this.currentSearchTerm)})}bindEvents(){const e=this.table.container.querySelector(".tablix-search-input"),t=this.table.container.querySelector(".tablix-search-clear");e&&(this.currentSearchTerm&&e.value!==this.currentSearchTerm&&(e.value=this.currentSearchTerm),e.addEventListener("input",this.handleSearchInput),e.addEventListener("keydown",e=>{"Escape"===e.key&&this.clearSearch()})),t&&t.addEventListener("click",this.handleSearchClear),this.updateClearButtonVisibility()}handleSearchInput(e){const t=e.target.value;this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.performSearch(t)},this.options.searchDelay)}handleSearchClear(e){e.preventDefault(),this.clearSearch()}async performSearch(e){const t=this.currentSearchTerm,a=this.table.container.querySelector(".tablix-search-input"),i=a&&document.activeElement===a,r=a&&a.selectionStart||0;if(this.table.eventManager.trigger("beforeSearch",{searchTerm:e,previousTerm:t,minLength:this.options.minLength,searchDelay:this.options.searchDelay,willSearch:e.length>=this.options.minLength}),this.currentSearchTerm=e,this.options.minLength>e.length)this.table.dataManager.filteredData=[...this.originalData];else{const t=this.filterData(e);this.table.dataManager.filteredData=t}this.table.paginationManager&&this.table.paginationManager.resetToFirstPage(),await this.table.refreshTable(),i&&requestAnimationFrame(()=>{const e=this.table.container.querySelector(".tablix-search-input");e&&(e.focus(),r>0&&e.value.length>=r&&e.setSelectionRange(r,r))});const n={searchTerm:e,previousTerm:t,resultsCount:this.table.dataManager.filteredData.length,totalCount:this.originalData.length,isActive:this.isSearchActive(),searchPerformed:e.length>=this.options.minLength};this.table.eventManager.trigger("afterSearch",n),this.updateClearButtonVisibility()}filterData(e){if(!e||""===e.trim())return[...this.originalData];const t=this.options.caseSensitive?e:e.toLowerCase(),a=this.getSearchableColumns();return this.originalData.filter(e=>a.some(a=>{const i=e[a];if(null==i)return!1;return(this.options.caseSensitive?i+"":(i+"").toLowerCase()).includes(t)}))}getSearchableColumns(){if(this.options.searchColumns&&this.options.searchColumns.length>0)return this.options.searchColumns;return(this.table.columnManager?this.table.columnManager.getColumns():this.table.options.columns||[]).map(e=>e.name||e.key).filter(e=>e)}async clearSearch(){this.updateInputValue(""),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),await this.performSearch("")}updateClearButtonVisibility(){const e=this.table.container.querySelector(".tablix-search-clear");e&&(e.style.display=this.currentSearchTerm?"block":"none")}updateInputValue(e){const t=this.table.container.querySelector(".tablix-search-input");t&&t.value!==e&&(t.value=e)}async setSearchTerm(e){this.updateInputValue(e),this.searchTimeout&&(clearTimeout(this.searchTimeout),this.searchTimeout=null),await this.performSearch(e)}getSearchTerm(){return this.currentSearchTerm}isSearchActive(){return this.currentSearchTerm&&this.currentSearchTerm.length>=this.options.minLength}getSearchInfo(){return{searchTerm:this.currentSearchTerm,resultsCount:this.table.dataManager.filteredData.length,totalCount:this.originalData.length,isActive:this.isSearchActive()}}configure(e){const t={...this.options};if(this.options={...this.options,...e},this.options.placeholder||(this.options.placeholder="Search..."),e.placeholder&&e.placeholder!==t.placeholder){const e=this.table.container.querySelector(".tablix-search-input");e&&(e.placeholder=this.options.placeholder)}void 0!==e.minLength&&this.currentSearchTerm&&this.performSearch(this.currentSearchTerm)}getConfiguration(){return{...this.options}}destroy(){this.searchTimeout&&clearTimeout(this.searchTimeout);const e=this.table.container.querySelector(".tablix-search-input"),t=this.table.container.querySelector(".tablix-search-clear");e&&e.removeEventListener("input",this.handleSearchInput),t&&t.removeEventListener("click",this.handleSearchClear)}}class c{constructor(e,t={}){this.table=e,this.options={enabled:!1,mode:"single",...t},this.selectedRows=new Set,this.lastSelectedRow=null,this.rowIdMap=new Map,this.dataIdKey=t.dataIdKey||"id",this.dragSelection={isActive:!1,startRowIndex:null,currentRowIndex:null,startRowId:null,originalSelection:null,isDragging:!1,dragThreshold:3},this.eventListeners=[],this.init()}init(){this.eventListenersSetup=!1,this.options.enabled&&this.setupEventListeners()}setupEventListeners(){this.eventListenersSetup||(this.eventListenersSetup=!0,this.table.eventManager.on("rowClick",e=>{this.handleRowClick(e)}),"multi"!==this.options.mode||this.table.virtualScrollManager||this.setupDragSelection(),this.table.eventManager.on("beforeLoad",()=>{this.clearSelection()}),this.table.eventManager.on("afterLoad",()=>{this.updateSelectionAfterDataChange()}),this.table.eventManager.on("afterRender",()=>{this.updateUI()}))}handleRowClick(e){if(!this.table||!this.options.enabled)return;if(this.dragSelection.isDragging)return void(this.dragSelection.isDragging=!1);const{rowData:t,originalEvent:a}=e,i=this.getRowId(t);console.log("SelectionManager handleRowClick:",{rowId:i,hasOriginalEvent:!!a,ctrlKey:a?a.ctrlKey:"no event",shiftKey:a?a.shiftKey:"no event",metaKey:a?a.metaKey:"no event",timestamp:Date.now()}),a&&(a.preventDefault(),a.stopPropagation());const r={rowData:t,rowId:i,currentSelection:Array.from(this.selectedRows),isCtrlClick:a&&(a.ctrlKey||a.metaKey),isShiftClick:a&&a.shiftKey,isDragSelection:!1};this.table&&this.table.eventManager&&this.table.eventManager.trigger("beforeSelect",r),"single"===this.options.mode?this.handleSingleSelection(i,t):"multi"===this.options.mode&&this.handleMultiSelection(i,t,a),this.updateUI();const n={rowData:t,rowId:i,selectedRows:Array.from(this.selectedRows),selectedData:this.getSelectedData(),isDragSelection:!1};this.table&&this.table.eventManager&&this.table.eventManager.trigger("afterSelect",n)}handleSingleSelection(e,t){this.selectedRows.has(e)?(this.selectedRows.clear(),this.lastSelectedRow=null):(this.selectedRows.clear(),this.selectedRows.add(e),this.lastSelectedRow=e)}handleMultiSelection(e,t,a){const i=a&&(a.ctrlKey||a.metaKey),r=a&&a.shiftKey;console.log("handleMultiSelection DETAILED:",{rowId:e,isCtrlClick:i,isShiftClick:r,"originalEvent.ctrlKey":a?a.ctrlKey:"no event","originalEvent.metaKey":a?a.metaKey:"no event","originalEvent.shiftKey":a?a.shiftKey:"no event",lastSelectedRow:this.lastSelectedRow,currentSelection:Array.from(this.selectedRows),selectionSize:this.selectedRows.size}),r&&this.lastSelectedRow?(console.log("Executing range selection from",this.lastSelectedRow,"to",e),this.handleRangeSelection(e)):i?(console.log("Executing ctrl+click toggle for",e),this.selectedRows.has(e)?(this.selectedRows.delete(e),console.log("Ctrl+click: Deselected",e),this.lastSelectedRow=this.selectedRows.size>0?Array.from(this.selectedRows)[0]:null):(this.selectedRows.add(e),this.lastSelectedRow=e,console.log("Ctrl+click: Added",e,"to selection. Total selected:",this.selectedRows.size))):(console.log("Executing normal click for",e),this.selectedRows.clear(),this.selectedRows.add(e),this.lastSelectedRow=e,console.log("Normal click: Selected only",e))}handleRangeSelection(e){const t=this.getFullData(),a=t.findIndex(e=>this.getRowId(e)===this.lastSelectedRow),i=t.findIndex(t=>this.getRowId(t)===e);if(-1===a||-1===i)return this.selectedRows.clear(),this.selectedRows.add(e),void(this.lastSelectedRow=e);const r=Math.min(a,i),n=Math.max(a,i);for(let e=r;n>=e;e++){const a=this.getRowId(t[e]);this.selectedRows.add(a)}}setupDragSelection(){const e=this.table.container;if(!e)return;let t,a;e.addEventListener("mousedown",e=>{if(!this.table||!this.options.enabled||"multi"!==this.options.mode)return;const i=e.target.closest(".tablix-row");if(!i||i.classList.contains("tablix-empty-row"))return;const r=parseInt(i.dataset.rowIndex,10);if(isNaN(r))return;if(e.ctrlKey||e.metaKey||e.shiftKey)return;t=e.clientX,a=e.clientY,this.dragSelection.isActive=!0,this.dragSelection.startRowIndex=r,this.dragSelection.currentRowIndex=r,this.dragSelection.isDragging=!1,this.dragSelection.originalSelection=new Set(this.selectedRows);const n=this.getFullData();n.length>r&&(this.dragSelection.startRowId=this.getRowId(n[r])),e.preventDefault()}),e.addEventListener("mousemove",e=>{if(!this.table||!this.dragSelection.isActive)return;this.dragSelection.isDragging||this.dragSelection.dragThreshold>=Math.abs(e.clientX-t)&&this.dragSelection.dragThreshold>=Math.abs(e.clientY-a)||(this.dragSelection.isDragging=!0,this.startDragSelection()),this.dragSelection.isDragging&&this.updateDragSelection(e)}),e.addEventListener("mouseup",e=>{this.table&&this.dragSelection.isActive&&this.completeDragSelection()}),e.addEventListener("mouseleave",e=>{this.table&&this.dragSelection.isActive&&this.cancelDragSelection()}),e.addEventListener("selectstart",e=>{this.dragSelection.isDragging&&e.preventDefault()})}startDragSelection(){if(!this.table||!this.table.container)return void console.warn("SelectionManager: Cannot start drag selection - table not available");const e=this.table.container.querySelector(".tablix-wrapper");e&&e.classList.add("tablix-drag-selecting");const t=this.getFullData();if(t.length>this.dragSelection.startRowIndex){const e={rowData:t[this.dragSelection.startRowIndex],rowId:this.dragSelection.startRowId,currentSelection:Array.from(this.selectedRows),isCtrlClick:!1,isShiftClick:!1,isDragSelection:!0,dragStart:!0};this.table.eventManager.trigger("beforeSelect",e)}}updateDragSelection(e){const t=e.target.closest(".tablix-row");if(!t||t.classList.contains("tablix-empty-row"))return;const a=parseInt(t.dataset.rowIndex,10);isNaN(a)||a!==this.dragSelection.currentRowIndex&&(this.dragSelection.currentRowIndex=a,this.applyDragSelection())}applyDragSelection(){const e=this.getFullData(),t=this.dragSelection.startRowIndex,a=this.dragSelection.currentRowIndex,i=Math.min(t,a),r=Math.max(t,a);this.selectedRows=new Set(this.dragSelection.originalSelection);for(let t=i;r>=t;t++)if(e.length>t){const a=this.getRowId(e[t]);this.selectedRows.add(a)}e.length>a&&(this.lastSelectedRow=this.getRowId(e[a])),this.updateUI()}completeDragSelection(){if(!this.table||!this.table.container)return void console.warn("SelectionManager: Cannot complete drag selection - table not available");const e=this.table.container.querySelector(".tablix-wrapper");if(e&&e.classList.remove("tablix-drag-selecting"),this.dragSelection.isDragging){const e={selectedRows:Array.from(this.selectedRows),selectedData:this.getSelectedData(),isDragSelection:!0,dragComplete:!0};this.table.eventManager.trigger("afterSelect",e)}this.resetDragSelection()}cancelDragSelection(){if(!this.table||!this.table.container)return void console.warn("SelectionManager: Cannot cancel drag selection - table not available");const e=this.table.container.querySelector(".tablix-wrapper");e&&e.classList.remove("tablix-drag-selecting"),this.selectedRows=new Set(this.dragSelection.originalSelection),this.updateUI(),this.resetDragSelection()}resetDragSelection(){this.dragSelection.isActive=!1,this.dragSelection.startRowIndex=null,this.dragSelection.currentRowIndex=null,this.dragSelection.startRowId=null,this.dragSelection.originalSelection=null,this.dragSelection.isDragging=!1}getRowId(e){return void 0!==e[this.dataIdKey]?e[this.dataIdKey]+"":this.createRowHash(e)}createRowHash(e){const t=JSON.stringify(e);let a=0;for(let e=0;t.length>e;e++){a=(a<<5)-a+t.charCodeAt(e),a&=a}return a+""}getCurrentPageData(){return this.table&&this.table.dataManager?this.table.virtualScrollManager?this.table.dataManager.getData():this.table.paginationManager?this.table.paginationManager.getCurrentPageData()||[]:this.table.dataManager.getData():(console.warn("SelectionManager: Table or dataManager is not available"),[])}getFullData(){return this.table&&this.table.dataManager?this.table.dataManager.getData():(console.warn("SelectionManager: Table or dataManager is not available"),[])}updateUI(){if(!this.options.enabled||!this.table||!this.table.container)return;const e=this.table.container.querySelector(".tablix-table");if(!e)return;const t=e.querySelectorAll(".tablix-row");t.forEach(e=>{e.classList.remove("tablix-selected","tablix-last-selected")});if(t.length>0&&t[0].hasAttribute("data-virtual-index")){const e=this.getFullData();t.forEach(t=>{const a=parseInt(t.getAttribute("data-virtual-index"));if(!isNaN(a)&&e.length>a){const i=this.getRowId(e[a]);this.selectedRows.has(i)&&(t.classList.add("tablix-selected"),i===this.lastSelectedRow&&t.classList.add("tablix-last-selected"))}})}else{const e=this.getFullData();t.forEach(t=>{const a=t.hasAttribute("data-row-index")?parseInt(t.getAttribute("data-row-index")):-1;if(a>=0&&e.length>a){const i=this.getRowId(e[a]);this.selectedRows.has(i)&&(t.classList.add("tablix-selected"),i===this.lastSelectedRow&&t.classList.add("tablix-last-selected"))}})}}updateSelectionAfterDataChange(){if(this.options.enabled)if(this.table.virtualScrollManager)this.updateUI();else{const e=this.getFullData(),t=new Set(e.map(e=>this.getRowId(e))),a=new Set;this.selectedRows.forEach(e=>{t.has(e)&&a.add(e)}),this.selectedRows=a,this.lastSelectedRow&&!t.has(this.lastSelectedRow)&&(this.lastSelectedRow=this.selectedRows.size>0?Array.from(this.selectedRows)[0]:null),this.updateUI()}}getSelectedData(){if(!this.options.enabled||0===this.selectedRows.size)return[];return this.getFullData().filter(e=>this.selectedRows.has(this.getRowId(e)))}getSelectedIds(){return Array.from(this.selectedRows)}selectRows(e){if(!this.options.enabled)return;const t=Array.isArray(e)?e:[e];"single"===this.options.mode&&t.length>1?console.warn("SelectionManager: Cannot select multiple rows in single mode"):("single"===this.options.mode&&this.selectedRows.clear(),t.forEach(e=>{this.selectedRows.add(e+"")}),t.length>0&&(this.lastSelectedRow=t[t.length-1]+""),this.updateUI(),this.table.eventManager.trigger("afterSelect",{selectedRows:Array.from(this.selectedRows),selectedData:this.getSelectedData()}))}deselectRows(e){if(!this.options.enabled)return;const t=Array.isArray(e)?e:[e];t.forEach(e=>{this.selectedRows.delete(e+"")}),t.includes(this.lastSelectedRow)&&(this.lastSelectedRow=this.selectedRows.size>0?Array.from(this.selectedRows)[0]:null),this.updateUI(),this.table.eventManager.trigger("afterSelect",{selectedRows:Array.from(this.selectedRows),selectedData:this.getSelectedData()})}clearSelection(){if(!this.options.enabled)return;const e=this.selectedRows.size>0;this.selectedRows.clear(),this.lastSelectedRow=null,this.updateUI(),e&&this.table.eventManager.trigger("afterSelect",{selectedRows:[],selectedData:[]})}isRowSelected(e){return this.selectedRows.has(e+"")}isRowSelectedByData(e){const t=this.getRowId(e);return this.selectedRows.has(t+"")}getSelectionCount(){return this.selectedRows.size}enable(){this.options.enabled=!0,this.eventListenersSetup||this.setupEventListeners()}disable(){this.options.enabled=!1,this.clearSelection()}setMode(e){if("single"!==e&&"multi"!==e)return void console.warn('SelectionManager: Invalid mode. Use "single" or "multi"');const t=this.options.mode;if(this.options.mode=e,"single"===e&&this.selectedRows.size>1){const e=this.lastSelectedRow;this.selectedRows.clear(),e&&this.selectedRows.add(e),this.updateUI()}t!==e&&this.options.enabled&&"multi"===e&&this.setupDragSelection()}destroy(){this.clearSelection(),this.table=null,this.selectedRows.clear(),this.rowIdMap.clear(),this.lastSelectedRow=null,this.dragSelection.isActive=!1,this.dragSelection.isDragging=!1,this.dragSelection.startRowIndex=null,this.dragSelection.currentRowIndex=null,this.dragSelection.startRowId=null,this.dragSelection.originalSelection=null}}class h{constructor(e,t={}){this.table=e,this.options={enabled:!1,buffer:10,rowHeight:null,throttleDelay:8,...t},this.scrollContainer=null,this.tableBody=null,this.topSpacer=null,this.bottomSpacer=null,this.rowHeight=this.options.rowHeight||35,this.containerHeight=0,this.totalRows=0,this.visibleStart=0,this.visibleEnd=0,this.renderedStart=0,this.renderedEnd=0,this.performanceData={renderTimes:[],scrollUpdates:0,lastMeasurement:0},this.throttledScrollHandler=this.throttle(this.handleScroll.bind(this),this.options.throttleDelay),this.immediateScrollHandler=this.handleScroll.bind(this),this.updateScheduled=!1,this.pendingUpdate=!1,this.lastScrollTime=0,this.scrollVelocity=0,this.data=[],this.renderedData=[]}init(e=[]){this.options.enabled&&(this.data=e,this.totalRows=e.length,this.setupScrollContainer(),this.detectRowHeight(),this.calculateViewport(),this.scheduleUpdate(),this.scrollContainer.addEventListener("scroll",this.handleScrollImmediate.bind(this),{passive:!0}),this.scrollContainer.addEventListener("scroll",this.throttledScrollHandler,{passive:!0}),this.scrollContainer.addEventListener("mousedown",this.handleScrollStart.bind(this)),document.addEventListener("mouseup",this.handleScrollEnd.bind(this)),window.addEventListener("resize",this.throttle(this.handleResize.bind(this),100)),this.setupEventDelegation(),this.setupSelectionListeners(),this.log("Virtual scroll initialized",{totalRows:this.totalRows,rowHeight:this.rowHeight,buffer:this.options.buffer}))}setupEventDelegation(){this.scrollContainer&&this.table.eventManager&&(this.rowClickHandler=e=>{const t=e.target.closest(".tablix-row");if(!t)return;if(this.justFinishedDrag)return void console.log("Skipping click - just finished drag");const a=parseInt(t.getAttribute("data-virtual-index")),i=this.data[a];i&&(console.log("VirtualScroll rowClickHandler triggered:",{virtualIndex:a,rowId:i.id,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,eventType:e.type,timestamp:Date.now()}),this.table.eventManager.trigger("rowClick",{rowData:i,rowIndex:a,originalEvent:e,element:t}),setTimeout(()=>this.updateSelectionStates(),0))},this.scrollContainer.addEventListener("click",this.rowClickHandler),this.table.selectionManager&&this.table.selectionManager.options.enabled&&"multi"===this.table.selectionManager.options.mode&&this.setupVirtualDragSelection(),this.rowHoverHandler=e=>{const t=e.target.closest(".tablix-row");if(!t)return;const a=parseInt(t.getAttribute("data-virtual-index")),i=this.data[a];i&&this.table.eventManager.trigger("rowHover",{rowData:i,rowIndex:a,originalEvent:e,element:t})},this.scrollContainer.addEventListener("mouseover",this.rowHoverHandler))}setupSelectionListeners(){this.table.eventManager&&(this.table.eventManager.on("afterSelect",()=>{this.updateSelectionStates()}),this.table.eventManager.on("selectionCleared",()=>{this.updateSelectionStates()}))}setupScrollContainer(){const e=this.table.container.querySelector(".tablix-wrapper");if(!e)throw Error("Table wrapper not found for virtual scrolling");let t=e.querySelector(".tablix-scroll-container");t||(t=e.querySelector(".tablix-scroll-container"),t)?(this.scrollContainer=t,this.tableBody=t.querySelector(".tablix-tbody"),this.createSpacers()):console.warn("Scroll container not found - virtual scrolling may not work properly")}createSpacers(){if(!this.tableBody)return;const e=this.tableBody.querySelector(".tablix-top-spacer"),t=this.tableBody.querySelector(".tablix-bottom-spacer");e&&e.remove(),t&&t.remove(),this.topSpacer=document.createElement("tr"),this.topSpacer.className="tablix-top-spacer",this.topSpacer.style.cssText="height: 0px; border: none;",this.topSpacer.innerHTML='<td colspan="100" style="padding: 0; border: none; height: 0;"></td>',this.bottomSpacer=document.createElement("tr"),this.bottomSpacer.className="tablix-bottom-spacer",this.bottomSpacer.style.cssText="height: 0px; border: none;",this.bottomSpacer.innerHTML='<td colspan="100" style="padding: 0; border: none; height: 0;"></td>',this.tableBody.insertBefore(this.topSpacer,this.tableBody.firstChild),this.tableBody.appendChild(this.bottomSpacer)}detectRowHeight(){if(this.options.rowHeight)return void(this.rowHeight=this.options.rowHeight);if(!this.tableBody||0===this.data.length)return;const e=this.renderSingleRow(this.data[0],0);this.tableBody.appendChild(e);const t=e.getBoundingClientRect();this.rowHeight=Math.max(t.height,25),e.remove(),this.log("Row height detected",{rowHeight:this.rowHeight})}calculateViewport(){if(!this.scrollContainer)return;const e=this.scrollContainer.getBoundingClientRect();this.containerHeight=e.height;const t=this.scrollContainer.scrollTop,a=Math.ceil(this.containerHeight/this.rowHeight);this.visibleStart=Math.floor(t/this.rowHeight),this.visibleEnd=Math.min(this.visibleStart+a,this.totalRows),this.renderedStart=Math.max(0,this.visibleStart-this.options.buffer),this.renderedEnd=Math.min(this.totalRows,this.visibleEnd+this.options.buffer),this.updateSpacers()}updateSpacers(){if(!this.topSpacer||!this.bottomSpacer)return;const e=(this.totalRows-this.renderedEnd)*this.rowHeight;this.topSpacer.style.height=this.renderedStart*this.rowHeight+"px",this.bottomSpacer.style.height=e+"px"}handleScrollImmediate(){const e=performance.now(),t=this.scrollContainer.scrollTop;if(this.lastScrollTime&&void 0!==this.lastScrollTop){const a=e-this.lastScrollTime;this.scrollVelocity=a>0?Math.abs(t-this.lastScrollTop)/a:0}this.lastScrollTime=e,this.lastScrollTop=t,this.scrollVelocity>2&&this.scheduleUpdate()}handleScrollStart(e){const t=e.target;t.closest(".tablix-row")||t.closest(".tablix-table")||(this.isScrollbarDragging=!0,this.scrollDragInterval=setInterval(()=>{this.isScrollbarDragging&&this.scheduleUpdate()},8))}handleScrollEnd(){this.isScrollbarDragging=!1,this.scrollDragInterval&&(clearInterval(this.scrollDragInterval),this.scrollDragInterval=null),this.scheduleUpdate()}setupVirtualDragSelection(){let e=!1,t=null,a=null,i=null,r=null;this.justFinishedDrag=!1,this.scrollContainer.addEventListener("mousedown",n=>{if(n.ctrlKey||n.metaKey||n.shiftKey)return;const s=n.target.closest(".tablix-row");if(!s||s.classList.contains("tablix-empty-row"))return;const l=parseInt(s.getAttribute("data-virtual-index"));isNaN(l)||(t=l,a=n.clientX,i=n.clientY,e=!1,r=new Set(this.table.selectionManager.selectedRows))}),this.scrollContainer.addEventListener("mousemove",n=>{if(null===t)return;if(e||3>=Math.abs(n.clientX-a)&&3>=Math.abs(n.clientY-i)||(e=!0,this.scrollContainer.classList.add("tablix-drag-selecting")),e){const e=n.target.closest(".tablix-row");if(e){const a=parseInt(e.getAttribute("data-virtual-index"));isNaN(a)||this.applyVirtualDragSelection(t,a,r)}}});const n=a=>{if(null!==t){if(this.scrollContainer.classList.remove("tablix-drag-selecting"),!e)return t=null,e=!1,void(r=null);this.table.eventManager.trigger("afterSelect",{selectedRows:Array.from(this.table.selectionManager.selectedRows),selectedData:this.table.selectionManager.getSelectedData(),isDragSelection:!0,dragComplete:!0}),this.justFinishedDrag=!0,setTimeout(()=>{this.justFinishedDrag=!1},50),t=null,e=!1,r=null}};document.addEventListener("mouseup",n),this.scrollContainer.addEventListener("mouseleave",n),this.scrollContainer.addEventListener("selectstart",t=>{e&&t.preventDefault()})}applyVirtualDragSelection(e,t,a){const i=Math.min(e,t),r=Math.max(e,t);this.table.selectionManager.selectedRows=new Set(a);for(let e=i;r>=e;e++)if(this.data.length>e){const t=this.table.selectionManager.getRowId(this.data[e]);this.table.selectionManager.selectedRows.add(t)}if(this.data.length>t){this.table.selectionManager.lastSelectedRow=this.table.selectionManager.getRowId(this.data[t])}this.table.selectionManager.updateUI()}handleScroll(){this.options.enabled&&!this.updateScheduled&&this.scheduleUpdate()}handleResize(){this.options.enabled&&(this.calculateViewport(),this.scheduleUpdate())}scheduleUpdate(){this.updateScheduled||(this.updateScheduled=!0,requestAnimationFrame(()=>{this.update(),this.updateScheduled=!1}))}update(){const e=performance.now();this.calculateViewport(),this.renderVisibleRows();const t=performance.now();this.trackPerformance(t-e),this.performanceData.scrollUpdates++}renderVisibleRows(){if(!this.tableBody)return;this.tableBody.querySelectorAll(".tablix-row").forEach(e=>e.remove());const e=document.createDocumentFragment();for(let t=this.renderedStart;this.renderedEnd>t;t++)if(this.data.length>t){const a=this.renderSingleRow(this.data[t],t);e.appendChild(a)}this.tableBody.insertBefore(e,this.bottomSpacer),this.renderedData=this.data.slice(this.renderedStart,this.renderedEnd),this.handleImageLoading(),this.updateSelectionStates()}updateSelectionStates(){if(!this.table.selectionManager||!this.tableBody)return;this.tableBody.querySelectorAll(".tablix-row").forEach(e=>{const t=parseInt(e.getAttribute("data-virtual-index")),a=this.data[t];a&&this.table.selectionManager.isRowSelectedByData(a)?e.classList.add("tablix-selected"):e.classList.remove("tablix-selected")})}handleImageLoading(){if(!this.tableBody)return;this.tableBody.querySelectorAll(".tablix-row img").forEach((e,t)=>{if(e.complete||e.classList.contains("loading"))return;e.classList.add("loading");const a=e.cloneNode();a.src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiBmaWxsPSIjZjBmMGYwIi8+CjxwYXRoIGQ9Ik0xNiA4TDIwIDEySDEyTDE2IDhaIiBmaWxsPSIjY2NjY2NjIi8+CjxwYXRoIGQ9Ik04IDIwSDI0VjE2SDhWMjBaIiBmaWxsPSIjY2NjY2NjIi8+Cjwvc3ZnPgo=",a.classList.add("image-placeholder");const i=()=>{e.classList.remove("loading"),e.style.opacity="1",e.removeEventListener("load",i),e.removeEventListener("error",r)},r=()=>{e.classList.remove("loading"),e.src=a.src,e.removeEventListener("load",i),e.removeEventListener("error",r)};e.addEventListener("load",i),e.addEventListener("error",r),e.style.opacity="0.5",e.style.transition="opacity 0.2s ease"})}renderSingleRow(e,t){const a=this.table.columnManager?this.table.columnManager.getColumns():this.table.options.columns||[],i=document.createElement("tr");i.className="tablix-row",i.setAttribute("data-row-index",t),i.setAttribute("data-virtual-index",t),i.setAttribute("data-row-id",this.table.selectionManager?this.table.selectionManager.getRowId(e):t);return this.table.selectionManager&&this.table.selectionManager.isRowSelectedByData(e)&&(i.classList.add("tablix-selected"),console.log("Row initially selected:",t,e.id)),a.forEach(t=>{const a=document.createElement("td");a.className="tablix-td";const r=e[t.name];if(this.table.columnManager){const i=this.table.columnManager.formatCellValue(t.name,r,e);i.isHtml?a.innerHTML=i.value:a.textContent=i.value}else if(t.renderer&&"function"==typeof t.renderer){const i=t.renderer(r,e);"string"==typeof i&&i.includes("<")?a.innerHTML=i:a.textContent=i}else a.textContent=null!=r?r+"":"";i.appendChild(a)}),i}updateData(e){this.data=e,this.totalRows=e.length,this.options.enabled&&(this.calculateViewport(),this.scheduleUpdate())}scrollToRow(e){if(!this.scrollContainer||!this.options.enabled)return;this.scrollContainer.scrollTop=e*this.rowHeight,this.update()}getVisibleRange(){return{start:this.visibleStart,end:this.visibleEnd,renderedStart:this.renderedStart,renderedEnd:this.renderedEnd}}getRenderedData(){return this.renderedData}isEnabled(){return this.options.enabled}setEnabled(e){this.options.enabled=e,e&&this.data.length>0&&this.init(this.data)}trackPerformance(e){this.performanceData.renderTimes.push(e),this.performanceData.lastMeasurement=e,this.performanceData.renderTimes.length>100&&this.performanceData.renderTimes.shift()}getPerformanceStats(){const e=this.performanceData.renderTimes;if(0===e.length)return null;const t=e.reduce((e,t)=>e+t,0)/e.length,a=Math.max(...e),i=Math.min(...e);return{averageRenderTime:t.toFixed(2),maxRenderTime:a.toFixed(2),minRenderTime:i.toFixed(2),scrollUpdates:this.performanceData.scrollUpdates,totalRows:this.totalRows,visibleRows:this.visibleEnd-this.visibleStart,renderedRows:this.renderedEnd-this.renderedStart}}throttle(e,t){let a;return function(){a||(e.apply(this,arguments),a=!0,setTimeout(()=>a=!1,t))}}log(e,t={}){this.table.options.debug&&console.log("[VirtualScroll] "+e,t)}destroy(){this.scrollContainer&&(this.scrollContainer.removeEventListener("scroll",this.throttledScrollHandler),this.scrollContainer.removeEventListener("scroll",this.handleScrollImmediate),this.scrollContainer.removeEventListener("mousedown",this.handleScrollStart)),document.removeEventListener("mouseup",this.handleScrollEnd),window.removeEventListener("resize",this.handleResize),this.scrollDragInterval&&(clearInterval(this.scrollDragInterval),this.scrollDragInterval=null),this.scrollContainer=null,this.tableBody=null,this.topSpacer=null,this.bottomSpacer=null}}class d{constructor(){this.currentLanguage="en",this.translations=new Map,this.fallbackLanguage="en",this.addTranslations("en",this.getDefaultEnglishTranslations())}getDefaultEnglishTranslations(){return{"general.loading":"Loading...","general.error":"Error","general.noData":"No data available","general.show":"Show","general.entries":"entries","general.of":"of","general.to":"to","general.records":"records","general.perPage":"per page","general.showing":"Showing","general.total":"Total","general.rows":"rows","search.placeholder":"Search...","search.clear":"Clear search","search.noResults":"No results found","search.resultsFound":"results found","pagination.first":"First","pagination.previous":"Previous","pagination.next":"Next","pagination.last":"Last","pagination.page":"Page","pagination.pageOf":"Page {currentPage} of {totalPages}","pagination.showingRecords":"Showing {startRow}-{endRow} of {totalRows} records","pagination.noRecords":"No records found","pagination.pageSize":"Records per page","sort.sortAscending":"Sort ascending","sort.sortDescending":"Sort descending","sort.sortedAscending":"Sorted ascending","sort.sortedDescending":"Sorted descending","sort.notSorted":"Not sorted","sort.clearSort":"Clear sorting","selection.selectRow":"Select row","selection.deselectRow":"Deselect row","selection.selectAll":"Select all","selection.deselectAll":"Deselect all","selection.selectedCount":"{count} selected","selection.selectAllVisible":"Select all visible rows","selection.clearSelection":"Clear selection","filter.filter":"Filter","filter.clearFilter":"Clear filter","filter.clearAllFilters":"Clear all filters","filter.applyFilter":"Apply filter","filter.filterBy":"Filter by","filter.filterColumn":"Filter column","filter.filterByValue":"Filter by Value","filter.filterByCondition":"Filter by Condition","filter.searchValues":"Search values...","filter.selectAll":"Select All","filter.noValuesAvailable":"No values available","filter.addCondition":"Add Condition","filter.removeCondition":"Remove condition","filter.value":"Value","filter.apply":"Apply","filter.clear":"Clear","filter.cancel":"Cancel","filter.contains":"Contains","filter.startsWith":"Starts with","filter.endsWith":"Ends with","filter.equals":"Equals","filter.notEquals":"Not equals","filter.greaterThan":"Greater than","filter.lessThan":"Less than","filter.greaterThanOrEqual":"Greater than or equal","filter.lessThanOrEqual":"Less than or equal","filter.between":"Between","filter.isEmpty":"Is empty","filter.isNotEmpty":"Is not empty","filter.selectValues":"Select values","filter.noOptionsAvailable":"No options available","controls.refresh":"Refresh data","controls.export":"Export data","controls.settings":"Settings","controls.columns":"Columns","controls.showColumns":"Show/Hide columns","virtualScroll.loadingMoreRows":"Loading more rows...","virtualScroll.scrollToTop":"Scroll to top","virtualScroll.scrollToBottom":"Scroll to bottom","error.loadingData":"Failed to load data","error.networkError":"Network error occurred","error.invalidData":"Invalid data format","error.serverError":"Server error occurred","error.timeout":"Request timed out","error.unknown":"An unknown error occurred","error.retry":"Retry","dataType.string":"Text","dataType.number":"Number","dataType.date":"Date","dataType.boolean":"Boolean","dataType.currency":"Currency","dataType.percentage":"Percentage","accessibility.table":"Data table","accessibility.sortableColumn":"Sortable column","accessibility.selectableRow":"Selectable row","accessibility.rowSelected":"Row selected","accessibility.rowNotSelected":"Row not selected","accessibility.pageNavigation":"Page navigation","accessibility.searchInput":"Search table data","accessibility.filterColumn":"Filter column","action.apply":"Apply","action.cancel":"Cancel","action.close":"Close","action.save":"Save","action.reset":"Reset","action.ok":"OK","action.yes":"Yes","action.no":"No","date.today":"Today","date.yesterday":"Yesterday","date.thisWeek":"This week","date.lastWeek":"Last week","date.thisMonth":"This month","date.lastMonth":"Last month","format.currency.symbol":"$","format.decimal.separator":".","format.thousand.separator":",","format.percentage.symbol":"%"}}setLanguage(e){"string"==typeof e&&""!==e.trim()?this.currentLanguage=e.toLowerCase().trim():console.warn("TablixJS Localization: Invalid language code provided. Using fallback.")}addTranslations(e,t){if("string"!=typeof e||!t||"object"!=typeof t)return void console.warn("TablixJS Localization: Invalid parameters for addTranslations.");const a=e.toLowerCase().trim();this.translations.has(a)||this.translations.set(a,{});const i=this.translations.get(a);this.translations.set(a,{...i,...t})}t(e,t={}){if("string"!=typeof e)return console.warn("TablixJS Localization: Translation key must be a string."),e;let a=this.getTranslationFromLanguage(this.currentLanguage,e);return null===a&&this.currentLanguage!==this.fallbackLanguage&&(a=this.getTranslationFromLanguage(this.fallbackLanguage,e)),null===a?(console.warn("TablixJS Localization: Translation not found for key: "+e),e):this.substituteParameters(a,t)}getTranslationFromLanguage(e,t){const a=this.translations.get(e);if(!a)return null;if(t in a&&"string"==typeof a[t])return a[t];const i=t.split(".");let r=a;for(const e of i){if(!r||"object"!=typeof r||!(e in r))return null;r=r[e]}return"string"==typeof r?r:null}substituteParameters(e,t){if(!t||"object"!=typeof t)return e;let a=e;return Object.keys(t).forEach(e=>{const i=RegExp(`\\{${e}\\}`,"g");a=a.replace(i,t[e])}),a}getCurrentLanguage(){return this.currentLanguage}getAvailableLanguages(){return Array.from(this.translations.keys())}hasLanguage(e){return this.translations.has(e.toLowerCase().trim())}getAllTranslations(){return this.translations.get(this.currentLanguage)||{}}removeLanguage(e){const t=e.toLowerCase().trim();t!==this.fallbackLanguage?(this.translations.delete(t),this.currentLanguage===t&&(this.currentLanguage=this.fallbackLanguage)):console.warn("TablixJS Localization: Cannot remove fallback language.")}clearTranslations(){const e=this.translations.get(this.fallbackLanguage);this.translations.clear(),this.translations.set(this.fallbackLanguage,e),this.currentLanguage=this.fallbackLanguage}formatNumber(e,t={}){const{style:a="decimal",currency:i="USD",minimumFractionDigits:r,maximumFractionDigits:n}=t;try{return new Intl.NumberFormat(this.getLocaleCode(),{style:a,currency:"currency"===a?i:void 0,minimumFractionDigits:r,maximumFractionDigits:n}).format(e)}catch(a){return this.fallbackNumberFormat(e,t)}}formatDate(e,t={}){const a=e instanceof Date?e:new Date(e);if(isNaN(a.getTime()))return""+e;try{return new Intl.DateTimeFormat(this.getLocaleCode(),t).format(a)}catch(e){return a.toLocaleDateString()}}getLocaleCode(){return{en:"en-US",fr:"fr-FR",es:"es-ES",de:"de-DE",it:"it-IT",pt:"pt-BR",ru:"ru-RU",ja:"ja-JP",ko:"ko-KR",zh:"zh-CN"}[this.currentLanguage]||this.currentLanguage||"en-US"}fallbackNumberFormat(e,t={}){const{style:a}=t;if("currency"===a){return`${this.t("format.currency.symbol")}${e.toFixed(2)}`}if("percent"===a){const t=this.t("format.percentage.symbol");return`${(100*e).toFixed(1)}${t}`}return""+e}pluralize(e,t,a,i={}){return this.t(1===e?t:a,{count:e,...i})}}const g={"general.loading":"Chargement...","general.error":"Erreur","general.noData":"Aucune donnée disponible","general.show":"Afficher","general.entries":"entrées","general.of":"de","general.to":"à","general.records":"enregistrements","general.perPage":"par page","general.showing":"Affichage","general.total":"Total","general.rows":"lignes","search.placeholder":"Rechercher...","search.clear":"Effacer la recherche","search.noResults":"Aucun résultat trouvé","search.resultsFound":"résultats trouvés","pagination.first":"Premier","pagination.previous":"Précédent","pagination.next":"Suivant","pagination.last":"Dernier","pagination.page":"Page","pagination.pageOf":"Page {currentPage} sur {totalPages}","pagination.showingRecords":"Affichage de {startRow} à {endRow} sur {totalRows} enregistrements","pagination.noRecords":"Aucun enregistrement trouvé","pagination.pageSize":"Enregistrements par page","sort.sortAscending":"Trier croissant","sort.sortDescending":"Trier décroissant","sort.sortedAscending":"Trié croissant","sort.sortedDescending":"Trié décroissant","sort.notSorted":"Non trié","sort.clearSort":"Effacer le tri","selection.selectRow":"Sélectionner la ligne","selection.deselectRow":"Désélectionner la ligne","selection.selectAll":"Tout sélectionner","selection.deselectAll":"Tout désélectionner","selection.selectedCount":"{count} sélectionné(s)","selection.selectAllVisible":"Sélectionner toutes les lignes visibles","selection.clearSelection":"Effacer la sélection","filter.filter":"Filtrer","filter.clearFilter":"Effacer le filtre","filter.clearAllFilters":"Effacer tous les filtres","filter.applyFilter":"Appliquer le filtre","filter.filterBy":"Filtrer par","filter.filterColumn":"Filtrer la colonne","filter.filterByValue":"Filtrer par valeur","filter.filterByCondition":"Filtrer par condition","filter.searchValues":"Rechercher des valeurs...","filter.selectAll":"Tout sélectionner","filter.noValuesAvailable":"Aucune valeur disponible","filter.addCondition":"Ajouter une condition","filter.removeCondition":"Supprimer la condition","filter.value":"Valeur","filter.apply":"Appliquer","filter.clear":"Effacer","filter.cancel":"Annuler","filter.contains":"Contient","filter.startsWith":"Commence par","filter.endsWith":"Se termine par","filter.equals":"Égal à","filter.notEquals":"Différent de","filter.greaterThan":"Supérieur à","filter.lessThan":"Inférieur à","filter.greaterThanOrEqual":"Supérieur ou égal à","filter.lessThanOrEqual":"Inférieur ou égal à","filter.between":"Entre","filter.isEmpty":"Est vide","filter.isNotEmpty":"N'est pas vide","filter.selectValues":"Sélectionner les valeurs","filter.noOptionsAvailable":"Aucune option disponible","controls.refresh":"Actualiser les données","controls.export":"Exporter les données","controls.settings":"Paramètres","controls.columns":"Colonnes","controls.showColumns":"Afficher/Masquer les colonnes","virtualScroll.loadingMoreRows":"Chargement de plus de lignes...","virtualScroll.scrollToTop":"Faire défiler vers le haut","virtualScroll.scrollToBottom":"Faire défiler vers le bas","error.loadingData":"Échec du chargement des données","error.networkError":"Erreur réseau","error.invalidData":"Format de données invalide","error.serverError":"Erreur serveur","error.timeout":"Délai d'attente dépassé","error.unknown":"Une erreur inconnue s'est produite","error.retry":"Réessayer","dataType.string":"Texte","dataType.number":"Nombre","dataType.date":"Date","dataType.boolean":"Booléen","dataType.currency":"Devise","dataType.percentage":"Pourcentage","accessibility.table":"Tableau de données","accessibility.sortableColumn":"Colonne triable","accessibility.selectableRow":"Ligne sélectionnable","accessibility.rowSelected":"Ligne sélectionnée","accessibility.rowNotSelected":"Ligne non sélectionnée","accessibility.pageNavigation":"Navigation des pages","accessibility.searchInput":"Rechercher dans les données du tableau","accessibility.filterColumn":"Filtrer la colonne","action.apply":"Appliquer","action.cancel":"Annuler","action.close":"Fermer","action.save":"Enregistrer","action.reset":"Réinitialiser","action.ok":"OK","action.yes":"Oui","action.no":"Non","date.today":"Aujourd'hui","date.yesterday":"Hier","date.thisWeek":"Cette semaine","date.lastWeek":"La semaine dernière","date.thisMonth":"Ce mois-ci","date.lastMonth":"Le mois dernier","format.currency.symbol":"€","format.decimal.separator":",","format.thousand.separator":" ","format.percentage.symbol":"%"},u={"general.loading":"Cargando...","general.error":"Error","general.noData":"No hay datos disponibles","general.show":"Mostrar","general.entries":"entradas","general.of":"de","general.to":"a","general.records":"registros","general.perPage":"por página","general.showing":"Mostrando","general.total":"Total","general.rows":"filas","search.placeholder":"Buscar...","search.clear":"Limpiar búsqueda","search.noResults":"No se encontraron resultados","search.resultsFound":"resultados encontrados","pagination.first":"Primero","pagination.previous":"Anterior","pagination.next":"Siguiente","pagination.last":"Último","pagination.page":"Página","pagination.pageOf":"Página {currentPage} de {totalPages}","pagination.showingRecords":"Mostrando {startRow} a {endRow} de {totalRows} registros","pagination.noRecords":"No se encontraron registros","pagination.pageSize":"Registros por página","sort.sortAscending":"Ordenar ascendente","sort.sortDescending":"Ordenar descendente","sort.sortedAscending":"Ordenado ascendente","sort.sortedDescending":"Ordenado descendente","sort.notSorted":"Sin ordenar","sort.clearSort":"Limpiar ordenación","selection.selectRow":"Seleccionar fila","selection.deselectRow":"Deseleccionar fila","selection.selectAll":"Seleccionar todo","selection.deselectAll":"Deseleccionar todo","selection.selectedCount":"{count} seleccionado(s)","selection.selectAllVisible":"Seleccionar todas las filas visibles","selection.clearSelection":"Limpiar selección","filter.filter":"Filtrar","filter.clearFilter":"Limpiar filtro","filter.clearAllFilters":"Limpiar todos los filtros","filter.applyFilter":"Aplicar filtro","filter.filterBy":"Filtrar por","filter.filterColumn":"Filtrar columna","filter.filterByValue":"Filtrar por valor","filter.filterByCondition":"Filtrar por condición","filter.searchValues":"Buscar valores...","filter.selectAll":"Seleccionar todo","filter.noValuesAvailable":"No hay valores disponibles","filter.addCondition":"Agregar condición","filter.removeCondition":"Eliminar condición","filter.value":"Valor","filter.apply":"Aplicar","filter.clear":"Limpiar","filter.cancel":"Cancelar","filter.contains":"Contiene","filter.startsWith":"Comienza con","filter.endsWith":"Termina con","filter.equals":"Igual a","filter.notEquals":"No igual a","filter.greaterThan":"Mayor que","filter.lessThan":"Menor que","filter.greaterThanOrEqual":"Mayor o igual a","filter.lessThanOrEqual":"Menor o igual a","filter.between":"Entre","filter.isEmpty":"Está vacío","filter.isNotEmpty":"No está vacío","filter.selectValues":"Seleccionar valores","filter.noOptionsAvailable":"No hay opciones disponibles","controls.refresh":"Actualizar datos","controls.export":"Exportar datos","controls.settings":"Configuración","controls.columns":"Columnas","controls.showColumns":"Mostrar/Ocultar columnas","virtualScroll.loadingMoreRows":"Cargando más filas...","virtualScroll.scrollToTop":"Desplazar hacia arriba","virtualScroll.scrollToBottom":"Desplazar hacia abajo","error.loadingData":"Error al cargar los datos","error.networkError":"Error de red","error.invalidData":"Formato de datos inválido","error.serverError":"Error del servidor","error.timeout":"Tiempo de espera agotado","error.unknown":"Ocurrió un error desconocido","error.retry":"Reintentar","dataType.string":"Texto","dataType.number":"Número","dataType.date":"Fecha","dataType.boolean":"Booleano","dataType.currency":"Moneda","dataType.percentage":"Porcentaje","accessibility.table":"Tabla de datos","accessibility.sortableColumn":"Columna ordenable","accessibility.selectableRow":"Fila seleccionable","accessibility.rowSelected":"Fila seleccionada","accessibility.rowNotSelected":"Fila no seleccionada","accessibility.pageNavigation":"Navegación de páginas","accessibility.searchInput":"Buscar en los datos de la tabla","accessibility.filterColumn":"Filtrar columna","action.apply":"Aplicar","action.cancel":"Cancelar","action.close":"Cerrar","action.save":"Guardar","action.reset":"Restablecer","action.ok":"OK","action.yes":"Sí","action.no":"No","date.today":"Hoy","date.yesterday":"Ayer","date.thisWeek":"Esta semana","date.lastWeek":"La semana pasada","date.thisMonth":"Este mes","date.lastMonth":"El mes pasado","format.currency.symbol":"€","format.decimal.separator":",","format.thousand.separator":".","format.percentage.symbol":"%"},p={"general.loading":"Učitavanje...","general.error":"Greška","general.noData":"Nema dostupnih podataka","general.show":"Prikaži","general.entries":"unosa","general.of":"od","general.to":"do","general.records":"zapisa","general.perPage":"po stranici","general.showing":"Prikazano","general.total":"Ukupno","general.rows":"redova","search.placeholder":"Pretraga...","search.clear":"Obriši pretragu","search.noResults":"Nema rezultata","search.resultsFound":"rezultata pronađeno","pagination.first":"Prva","pagination.previous":"Prethodna","pagination.next":"Sledeća","pagination.last":"Poslednja","pagination.page":"Stranica","pagination.pageOf":"Stranica {currentPage} od {totalPages}","pagination.showingRecords":"Prikazano {startRow}-{endRow} od {totalRows} zapisa","pagination.noRecords":"Nema zapisa","pagination.pageSize":"Zapisa po stranici","sort.sortAscending":"Sortiraj rastuće","sort.sortDescending":"Sortiraj opadajuće","sort.sortedAscending":"Sortirano rastuće","sort.sortedDescending":"Sortirano opadajuće","sort.notSorted":"Nije sortirano","sort.clearSort":"Obriši sortiranje","selection.selectRow":"Izaberi red","selection.deselectRow":"Poništi izbor reda","selection.selectAll":"Izaberi sve","selection.deselectAll":"Poništi sve","selection.selectedCount":"{count} izabrano","selection.selectAllVisible":"Izaberi sve vidljive redove","selection.clearSelection":"Obriši izbor","filter.filter":"Filter","filter.clearFilter":"Obriši filter","filter.clearAllFilters":"Obriši sve filtere","filter.applyFilter":"Primeni filter","filter.filterBy":"Filtriraj po","filter.filterColumn":"Filtriraj kolonu","filter.filterByValue":"Filtriraj po vrednosti","filter.filterByCondition":"Filtriraj po uslovu","filter.searchValues":"Pretraži vrednosti...","filter.selectAll":"Izaberi sve","filter.noValuesAvailable":"Nema dostupnih vrednosti","filter.addCondition":"Dodaj uslov","filter.removeCondition":"Ukloni uslov","filter.value":"Vrednost","filter.apply":"Primeni","filter.clear":"Obriši","filter.cancel":"Otkaži","filter.contains":"Sadrži","filter.startsWith":"Počinje sa","filter.endsWith":"Završava se sa","filter.equals":"Jednako","filter.notEquals":"Nije jednako","filter.greaterThan":"Veće od","filter.lessThan":"Manje od","filter.greaterThanOrEqual":"Veće ili jednako","filter.lessThanOrEqual":"Manje ili jednako","filter.between":"Između","filter.isEmpty":"Prazno","filter.isNotEmpty":"Nije prazno","filter.selectValues":"Izaberi vrednosti","filter.noOptionsAvailable":"Nema dostupnih opcija","controls.refresh":"Osveži podatke","controls.export":"Izvezi podatke","controls.settings":"Podešavanja","controls.columns":"Kolone","controls.showColumns":"Prikaži/Sakrij kolone","virtualScroll.loadingMoreRows":"Učitavanje dodatnih redova...","virtualScroll.scrollToTop":"Idi na vrh","virtualScroll.scrollToBottom":"Idi na dno","error.loadingData":"Neuspešno učitavanje podataka","error.networkError":"Došlo je do mrežne greške","error.invalidData":"Neispravan format podataka","error.serverError":"Došlo je do greške na serveru","error.timeout":"Isteklo vreme zahteva","error.unknown":"Došlo je do nepoznate greške","error.retry":"Pokušaj ponovo","dataType.string":"Tekst","dataType.number":"Broj","dataType.date":"Datum","dataType.boolean":"Logička vrednost","dataType.currency":"Valuta","dataType.percentage":"Procenat","accessibility.table":"Tabela podataka","accessibility.sortableColumn":"Kolona za sortiranje","accessibility.selectableRow":"Red za izbor","accessibility.rowSelected":"Red izabran","accessibility.rowNotSelected":"Red nije izabran","accessibility.pageNavigation":"Navigacija stranica","accessibility.searchInput":"Pretraga podataka tabele","accessibility.filterColumn":"Filtriraj kolonu","action.apply":"Primeni","action.cancel":"Otkaži","action.close":"Zatvori","action.save":"Sačuvaj","action.reset":"Resetuj","action.ok":"U redu","action.yes":"Da","action.no":"Ne","date.today":"Danas","date.yesterday":"Juče","date.thisWeek":"Ove nedelje","date.lastWeek":"Prošle nedelje","date.thisMonth":"Ovog meseca","date.lastMonth":"Prošlog meseca","format.currency.symbol":"RSD","format.decimal.separator":",","format.thousand.separator":".","format.percentage.symbol":"%"};class b{constructor(b,f={}){this.container="string"==typeof b?document.querySelector(b):b,this.options={pagination:{enabled:!0,pageSize:10,mode:"client",showPageNumbers:!0,maxPageNumbers:5,showFirstLast:!0,showPrevNext:!0,showPageSizes:!1,pageSizeOptions:[10,25,50,100],serverDataLoader:null},sorting:{enabled:!0,mode:"client",serverSortLoader:null,defaultSortType:"auto",caseSensitive:!1,nullsFirst:!1},filtering:{enabled:!0,mode:"client",serverFilterLoader:null,debounceDelay:300,showBadges:!0,showTooltips:!0},controls:{enabled:!0,search:!0,pagination:!0,pageSize:!0,refresh:!0,export:!1,position:"top"},search:{enabled:!0,placeholder:null,searchDelay:300,minLength:1,caseSensitive:!1},selection:{enabled:!1,mode:"single",dataIdKey:"id"},virtualScroll:{enabled:!1,buffer:10,rowHeight:null,containerHeight:400},language:"en",translations:{},...f},this.localization=new d,this.localization.addTranslations("fr",g),this.localization.addTranslations("es",u),this.localization.addTranslations("sr",p),this.options.language&&this.localization.setLanguage(this.options.language),this.options.translations&&Object.keys(this.options.translations).forEach(e=>{this.localization.addTranslations(e,this.options.translations[e])}),this.eventManager=new a,this.columnManager=new n(this),this.dataManager=new e(this,f.data||[]),this.renderer=new t(this),f.columns&&this.columnManager.initializeColumns(f.columns),this.options.pagination&&!1!==this.options.pagination.enabled&&(this.paginationManager=new i(this,this.options.pagination)),this.options.sorting&&!1!==this.options.sorting.enabled&&(this.sortingManager=new r(this,this.options.sorting)),this.options.filtering&&!1!==this.options.filtering.enabled&&(this.filterManager=new s(this,this.options.filtering),this.filterUI=new l(this.filterManager)),this.options.search&&!1!==this.options.search.enabled&&(this.searchManager=new o(this,this.options.search)),this.options.selection&&(this.selectionManager=new c(this,this.options.selection)),this.options.virtualScroll&&(this.virtualScrollManager=new h(this,this.options.virtualScroll)),this.init()}async init(){try{this.searchManager&&this.searchManager.init();const e=this.dataManager.getData();this.eventManager.trigger("beforeLoad",{source:e}),await this.refreshTable(),this.eventManager.trigger("afterLoad",{data:e,source:e})}catch(e){console.error("Failed to initialize table:",e),this.eventManager.trigger("loadError",{error:e,source:"initialization"}),this.renderer&&this.renderer.renderError&&this.renderer.renderError(e)}}async refreshTable(){let e;this.virtualScrollManager&&this.virtualScrollManager.isEnabled()?(e=this.dataManager.getData(),this.virtualScrollManager.updateData(e),this.renderer.renderTable([],!0),this.virtualScrollManager.init(e)):this.paginationManager?(e=await this.paginationManager.getPageData(),this.renderer.renderTable(e)):(e=this.dataManager.getData(),this.renderer.renderTable(e))}async loadData(e){try{let t;if(this.eventManager.trigger("beforeLoad",{source:e}),Array.isArray(e))t=e;else if("string"==typeof e)t=await this._fetchFromUrl(e);else{if("function"!=typeof e)throw Error("Invalid data source. Expected array, URL string, or function.");t=await e()}if(!Array.isArray(t))throw Error("Data source must resolve to an array.");this.dataManager.setData(t),await this.refreshTable(),this.eventManager.trigger("afterLoad",{data:t,source:e})}catch(t){throw console.error("Error loading data:",t),this.eventManager.trigger("loadError",{error:t,source:e}),this.renderer&&this.renderer.renderError&&this.renderer.renderError(t),t}}async _fetchFromUrl(e){if("undefined"==typeof fetch)throw Error("fetch is not available. Please use a modern browser or provide a polyfill.");const t=await fetch(e);if(!t.ok)throw Error(`HTTP error! status: ${t.status} - ${t.statusText}`);return await t.json()}async filter(e){this.dataManager.applyFilter(e),await this.refreshTable(),this.eventManager.trigger("afterFilter",e)}async sort(e,t="asc"){this.sortingManager?await this.sortingManager.sort(e,t):(this.dataManager.applySorting([{column:e,direction:t}]),await this.refreshTable(),this.eventManager.trigger("afterSort",[{column:e,direction:t}]))}async toggleSort(e){this.sortingManager&&await this.sortingManager.toggleSort(e)}async clearSorting(){this.sortingManager?await this.sortingManager.clearSorting():(this.dataManager.clearSorting(),await this.refreshTable(),this.eventManager.trigger("afterSort",[]))}getSortState(){return this.sortingManager?this.sortingManager.getSortState():{sort:null,mode:"client"}}async clearFilters(){this.dataManager.clearFilters(),await this.refreshTable(),this.eventManager.trigger("afterFilter",{})}async clearSorting(){this.sortingManager?await this.sortingManager.clearSorting():(this.dataManager.clearSorting(),await this.refreshTable(),this.eventManager.trigger("afterSort",[]))}async applyFilter(e,t){this.filterManager?await this.filterManager.applyFilter(e,t):console.warn("TablixJS: Filtering is not enabled. Set filtering.enabled to true in options.")}async clearFilter(e){this.filterManager&&await this.filterManager.clearFilter(e)}async clearAllFilters(){this.filterManager?await this.filterManager.clearAllFilters():(this.dataManager.clearFilters(),await this.refreshTable(),this.eventManager.trigger("afterFilter",{}))}getActiveFilters(){return this.filterManager?this.filterManager.getActiveFilters():{}}getColumnFilter(e){return this.filterManager?this.filterManager.getColumnFilter(e):null}async setSearchTerm(e){this.searchManager?await this.searchManager.setSearchTerm(e):console.warn("TablixJS: Search is not enabled. Set search.enabled to true in options.")}getSearchTerm(){return this.searchManager?this.searchManager.getSearchTerm():""}async clearSearch(){this.searchManager&&await this.searchManager.clearSearch()}getSearchInfo(){return this.searchManager?this.searchManager.getSearchInfo():null}async nextPage(){this.paginationManager&&await this.paginationManager.nextPage()}async prevPage(){this.paginationManager&&await this.paginationManager.prevPage()}async firstPage(){this.paginationManager&&await this.paginationManager.firstPage()}async lastPage(){this.paginationManager&&await this.paginationManager.lastPage()}async goToPage(e){this.paginationManager&&await this.paginationManager.goToPage(e)}async changePageSize(e){this.paginationManager&&await this.paginationManager.changePageSize(e)}getPaginationInfo(){return this.paginationManager?this.paginationManager.getInfo():null}async setPaginationEnabled(e){this.paginationManager?(this.paginationManager.setEnabled(e),await this.refreshTable()):e&&(this.paginationManager=new i(this,this.options.pagination),await this.refreshTable())}async setPaginationMode(e,t=null){this.paginationManager&&await this.paginationManager.setMode(e,t)}on(e,t){this.eventManager.on(e,t)}off(e,t){this.eventManager.off(e,t)}clearEvents(e){this.eventManager.clear(e)}trigger(e,t){this.eventManager.trigger(e,t)}getData(){return this.dataManager.getData()}getOriginalData(){return this.dataManager.originalData}getOptions(){return this.options}async setOptions(e){this.options={...this.options,...e},e.pagination&&this.paginationManager&&(this.paginationManager.options={...this.paginationManager.options,...e.pagination}),e.selection&&this.selectionManager&&(this.selectionManager.options={...this.selectionManager.options,...e.selection},void 0!==e.selection.enabled&&(e.selection.enabled?this.selectionManager.enable():this.selectionManager.disable()),e.selection.mode&&this.selectionManager.setMode(e.selection.mode)),await this.refreshTable()}getSelectedData(){return this.selectionManager?this.selectionManager.getSelectedData():[]}getSelectedIds(){return this.selectionManager?this.selectionManager.getSelectedIds():[]}selectRows(e){this.selectionManager&&this.selectionManager.selectRows(e)}deselectRows(e){this.selectionManager&&this.selectionManager.deselectRows(e)}clearSelection(){this.selectionManager&&this.selectionManager.clearSelection()}isRowSelected(e){return!!this.selectionManager&&this.selectionManager.isRowSelected(e)}getSelectionCount(){return this.selectionManager?this.selectionManager.getSelectionCount():0}enableSelection(){this.selectionManager&&this.selectionManager.enable()}disableSelection(){this.selectionManager&&this.selectionManager.disable()}setSelectionMode(e){this.selectionManager&&this.selectionManager.setMode(e)}selectAllRows(){if(!this.selectionManager)return console.warn("TablixJS: Selection is not enabled. Set selection.enabled to true in options."),0;const e=this.getData();if(0===e.length)return console.warn("TablixJS: No rows available to select."),0;const t=this.options.selection.dataIdKey||"id",a=e.map(e=>e[t]+"");return this.selectionManager.selectRows(a),this.eventManager.trigger("selectAll",{selectedIds:a,selectedData:e,count:e.length}),e.length}t(e,t={}){return this.localization.t(e,t)}setLanguage(e){this.filterUI&&this.filterUI.activeDropdown&&this.filterUI.closeAllDropdowns(),this.localization.setLanguage(e),this.options.language=e,this.ensureLanguageTranslations(e),this.refreshTable()}ensureLanguageTranslations(e){if(this.localization.hasLanguage(e))return;const t={fr:()=>g,es:()=>u,sr:()=>p};if(t[e])try{const a=t[e]();this.localization.addTranslations(e,a),console.log(`TablixJS: Auto-loaded ${e} translations`)}catch(t){console.warn(`TablixJS: Failed to auto-load ${e} translations:`,t)}}addTranslations(e,t){this.localization.addTranslations(e,t),e===this.localization.getCurrentLanguage()&&this.refreshTable()}addLanguagePack(e,t,a=!1){this.addTranslations(e,t),a&&this.setLanguage(e),console.log(`TablixJS: Language pack '${e}' added successfully`)}getCurrentLanguage(){return this.localization.getCurrentLanguage()}getAvailableLanguages(){return this.localization.getAvailableLanguages()}hasLanguage(e){return this.localization.hasLanguage(e)}formatNumber(e,t={}){return this.localization.formatNumber(e,t)}formatDate(e,t={}){return this.localization.formatDate(e,t)}destroy(){this.virtualScrollManager&&this.virtualScrollManager.destroy(),this.selectionManager&&this.selectionManager.destroy&&this.selectionManager.destroy(),this.searchManager&&this.searchManager.destroy&&this.searchManager.destroy(),this.filterManager&&this.filterManager.destroy&&this.filterManager.destroy(),this.sortingManager&&this.sortingManager.destroy&&this.sortingManager.destroy(),this.paginationManager&&this.paginationManager.destroy&&this.paginationManager.destroy(),this.container&&(this.container.innerHTML=""),this.virtualScrollManager=null,this.selectionManager=null,this.searchManager=null,this.filterManager=null,this.sortingManager=null,this.paginationManager=null,this.dataManager=null,this.renderer=null,this.eventManager=null}destroy(){const e=this.container.querySelector(".tablix-pagination");e&&e.removeEventListener("click",this._paginationClickHandler),this.selectionManager&&this.selectionManager.destroy(),this.container.innerHTML="",this.dataManager=null,this.renderer=null,this.eventManager=null,this.paginationManager=null,this.sortingManager=null,this.selectionManager=null}}const f=b;f.Table=b,"undefined"!=typeof window?window.TablixJS=f:"undefined"!=typeof global&&(global.TablixJS=f);const m=function(){const e="undefined"!=typeof window&&(window.jQuery||window.$)||"undefined"!=typeof global&&(global.jQuery||global.$)||("function"==typeof require?(()=>{try{return require("jquery")}catch(e){return null}})():null);if(!e)return console.warn("TablixJS jQuery wrapper: jQuery is not available. The wrapper will not be registered."),!1;const t="tablixJS",a="tablixjs-instance";return e.fn[t]=function(t,...i){if("string"==typeof t){const r=t,n=e(this.first()),s=n.data(a);if(!s)return console.error(`TablixJS: Cannot call method '${r}' - table not initialized`),this;if(["getData","getSelectedData","getSelectedIds","getPaginationInfo","getSearchTerm","getSearchInfo","getActiveFilters","getColumnFilter","getSortState","getSelectionCount","isRowSelected"].includes(r))switch(r){case"getData":return s.getData();case"getSelectedData":return s.getSelectedData();case"getSelectedIds":return s.getSelectedIds();case"getPaginationInfo":return s.getPaginationInfo();case"getSearchTerm":return s.getSearchTerm();case"getSearchInfo":return s.getSearchInfo();case"getActiveFilters":return s.getActiveFilters();case"getColumnFilter":return s.getColumnFilter(i[0]);case"getSortState":return s.getSortState();case"getSelectionCount":return s.getSelectionCount();case"isRowSelected":return s.isRowSelected(i[0]);default:return}switch(r){case"destroy":s.destroy(),n.removeData(a);break;case"reload":case"loadData":const e=i[0];e&&s.loadData(e);break;case"clearSelection":s.clearSelection();break;case"refresh":s.refreshTable();break;case"selectRows":s.selectRows(i[0]);break;case"deselectRows":s.deselectRows(i[0]);break;case"selectAllRows":s.selectAllRows();break;case"clearSearch":s.clearSearch();break;case"setSearchTerm":s.setSearchTerm(i[0]);break;case"applyFilter":s.applyFilter(i[0],i[1]);break;case"clearFilter":s.clearFilter(i[0]);break;case"clearAllFilters":s.clearAllFilters();break;case"sort":s.sort(i[0],i[1]);break;case"toggleSort":s.toggleSort(i[0]);break;case"clearSorting":s.clearSorting();break;case"nextPage":s.nextPage();break;case"prevPage":s.prevPage();break;case"firstPage":s.firstPage();break;case"lastPage":s.lastPage();break;case"goToPage":s.goToPage(i[0]);break;case"changePageSize":s.changePageSize(i[0]);break;default:console.warn(`TablixJS: Unknown method '${r}'`)}return this}return this.each(function(){!function(e,t={}){const i=e.data(a);i&&(console.warn("TablixJS: Reinitializing existing table instance."),i.destroy());const r=function(e){const t={...e};e.container&&e.container.jquery&&(t.container=e.container[0]);return t}(t);try{const t=new b(e[0],r);e.data(a,t),function(e,t){["beforeLoad","afterLoad","loadError","beforeSort","afterSort","beforeFilter","afterFilter","beforePageChange","afterPageChange","selectionChanged","selectAll"].forEach(a=>{t.on(a,t=>{e.trigger("tablixjs:"+a,t)})})}(e,t)}catch(e){console.error("TablixJS: Failed to initialize table:",e)}}(e(this),t)})},e.fn[t].getInstance=function(t){const i=e(t);return i.length>0?i.data(a):null},e.fn[t].isInitialized=function(t){const i=e(t);return i.length>0&&!!i.data(a)},e.fn[t].destroyAll=function(){e(`[data-${a}]`).each(function(){const t=e(this),i=t.data(a);i&&(i.destroy(),t.removeData(a))})},console.log("TablixJS jQuery plugin initialized successfully (bundled version)"),!0}();return console.log("TablixJS jQuery bundle initialized:",m),f});
//# sourceMappingURL=tablix.jquery.min.js.map
